<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue | Yolanda</title>
    <meta name="description" content="æ¯å¤©å­¦ä¹ ä¸€ç‚¹ç‚¹">
    <link rel="icon" href="/Notebook/images/mylogo.jpg">
    
    <link rel="preload" href="/Notebook/assets/css/0.styles.4f932b82.css" as="style"><link rel="preload" href="/Notebook/assets/js/app.fae3116e.js" as="script"><link rel="preload" href="/Notebook/assets/js/3.8a90166b.js" as="script"><link rel="preload" href="/Notebook/assets/js/12.295d52cd.js" as="script"><link rel="prefetch" href="/Notebook/assets/js/10.7c0500f6.js"><link rel="prefetch" href="/Notebook/assets/js/11.96ce6645.js"><link rel="prefetch" href="/Notebook/assets/js/13.6db71019.js"><link rel="prefetch" href="/Notebook/assets/js/14.0c1400d8.js"><link rel="prefetch" href="/Notebook/assets/js/15.edab26a3.js"><link rel="prefetch" href="/Notebook/assets/js/16.88fd161d.js"><link rel="prefetch" href="/Notebook/assets/js/17.408350d5.js"><link rel="prefetch" href="/Notebook/assets/js/18.6ab68d1c.js"><link rel="prefetch" href="/Notebook/assets/js/19.9e9ef1da.js"><link rel="prefetch" href="/Notebook/assets/js/2.e3a9cac0.js"><link rel="prefetch" href="/Notebook/assets/js/20.56c42c66.js"><link rel="prefetch" href="/Notebook/assets/js/21.8d087c07.js"><link rel="prefetch" href="/Notebook/assets/js/22.cf2b0a03.js"><link rel="prefetch" href="/Notebook/assets/js/23.7413880a.js"><link rel="prefetch" href="/Notebook/assets/js/24.28bab990.js"><link rel="prefetch" href="/Notebook/assets/js/25.75c60686.js"><link rel="prefetch" href="/Notebook/assets/js/26.ef1edf61.js"><link rel="prefetch" href="/Notebook/assets/js/27.5aeea7cc.js"><link rel="prefetch" href="/Notebook/assets/js/28.8476b7e4.js"><link rel="prefetch" href="/Notebook/assets/js/29.956345a3.js"><link rel="prefetch" href="/Notebook/assets/js/30.b96e226e.js"><link rel="prefetch" href="/Notebook/assets/js/31.04440a69.js"><link rel="prefetch" href="/Notebook/assets/js/32.273112ca.js"><link rel="prefetch" href="/Notebook/assets/js/33.e709b2b3.js"><link rel="prefetch" href="/Notebook/assets/js/34.dc2136ae.js"><link rel="prefetch" href="/Notebook/assets/js/35.30ab0118.js"><link rel="prefetch" href="/Notebook/assets/js/36.cb41bc4a.js"><link rel="prefetch" href="/Notebook/assets/js/37.dd26a76e.js"><link rel="prefetch" href="/Notebook/assets/js/38.68398169.js"><link rel="prefetch" href="/Notebook/assets/js/39.93b8990e.js"><link rel="prefetch" href="/Notebook/assets/js/4.5f27db7e.js"><link rel="prefetch" href="/Notebook/assets/js/40.ed267aa9.js"><link rel="prefetch" href="/Notebook/assets/js/41.985eec03.js"><link rel="prefetch" href="/Notebook/assets/js/42.260a858d.js"><link rel="prefetch" href="/Notebook/assets/js/43.6cb97df7.js"><link rel="prefetch" href="/Notebook/assets/js/44.869ede03.js"><link rel="prefetch" href="/Notebook/assets/js/45.bf3e5a26.js"><link rel="prefetch" href="/Notebook/assets/js/46.a54b425c.js"><link rel="prefetch" href="/Notebook/assets/js/47.8ebe066b.js"><link rel="prefetch" href="/Notebook/assets/js/48.416ad307.js"><link rel="prefetch" href="/Notebook/assets/js/49.7394cd78.js"><link rel="prefetch" href="/Notebook/assets/js/5.01244a1f.js"><link rel="prefetch" href="/Notebook/assets/js/50.4675f4c4.js"><link rel="prefetch" href="/Notebook/assets/js/51.a112471f.js"><link rel="prefetch" href="/Notebook/assets/js/52.a6195fbf.js"><link rel="prefetch" href="/Notebook/assets/js/53.15f5f0a8.js"><link rel="prefetch" href="/Notebook/assets/js/54.bbc6eb3c.js"><link rel="prefetch" href="/Notebook/assets/js/55.ba5d1f28.js"><link rel="prefetch" href="/Notebook/assets/js/56.2d5a7c0d.js"><link rel="prefetch" href="/Notebook/assets/js/57.b6f47637.js"><link rel="prefetch" href="/Notebook/assets/js/58.3ce0f8ce.js"><link rel="prefetch" href="/Notebook/assets/js/59.66784ebf.js"><link rel="prefetch" href="/Notebook/assets/js/6.4d03de1b.js"><link rel="prefetch" href="/Notebook/assets/js/60.2c355106.js"><link rel="prefetch" href="/Notebook/assets/js/61.1fb23164.js"><link rel="prefetch" href="/Notebook/assets/js/62.5ee4cd1c.js"><link rel="prefetch" href="/Notebook/assets/js/63.08a71f63.js"><link rel="prefetch" href="/Notebook/assets/js/64.e7464a6a.js"><link rel="prefetch" href="/Notebook/assets/js/65.de9108af.js"><link rel="prefetch" href="/Notebook/assets/js/66.83e75f1b.js"><link rel="prefetch" href="/Notebook/assets/js/67.3caaf58d.js"><link rel="prefetch" href="/Notebook/assets/js/68.2dd69095.js"><link rel="prefetch" href="/Notebook/assets/js/69.927efe78.js"><link rel="prefetch" href="/Notebook/assets/js/7.a97cfeeb.js"><link rel="prefetch" href="/Notebook/assets/js/70.92fd8264.js"><link rel="prefetch" href="/Notebook/assets/js/71.0ef73e07.js"><link rel="prefetch" href="/Notebook/assets/js/72.7e0a2fee.js"><link rel="prefetch" href="/Notebook/assets/js/73.816bc4b8.js"><link rel="prefetch" href="/Notebook/assets/js/74.e1c44e90.js"><link rel="prefetch" href="/Notebook/assets/js/75.52d5991e.js"><link rel="prefetch" href="/Notebook/assets/js/76.3ab263b9.js"><link rel="prefetch" href="/Notebook/assets/js/77.76e6e752.js"><link rel="prefetch" href="/Notebook/assets/js/78.e2711be8.js"><link rel="prefetch" href="/Notebook/assets/js/79.ecf0c259.js"><link rel="prefetch" href="/Notebook/assets/js/8.698b291a.js"><link rel="prefetch" href="/Notebook/assets/js/80.6defbc57.js"><link rel="prefetch" href="/Notebook/assets/js/81.650b6435.js"><link rel="prefetch" href="/Notebook/assets/js/82.f41e2c82.js"><link rel="prefetch" href="/Notebook/assets/js/83.62a3d0ce.js"><link rel="prefetch" href="/Notebook/assets/js/84.f2e0ba7a.js"><link rel="prefetch" href="/Notebook/assets/js/85.7d5af1cd.js"><link rel="prefetch" href="/Notebook/assets/js/86.883b02f7.js"><link rel="prefetch" href="/Notebook/assets/js/87.dc5913fb.js"><link rel="prefetch" href="/Notebook/assets/js/88.369e5f01.js"><link rel="prefetch" href="/Notebook/assets/js/89.fd496723.js"><link rel="prefetch" href="/Notebook/assets/js/9.220abfab.js"><link rel="prefetch" href="/Notebook/assets/js/90.1d16c82f.js"><link rel="prefetch" href="/Notebook/assets/js/91.6bcdcb57.js"><link rel="prefetch" href="/Notebook/assets/js/92.3f6beaea.js"><link rel="prefetch" href="/Notebook/assets/js/93.d98ca184.js">
    <link rel="stylesheet" href="/Notebook/assets/css/0.styles.4f932b82.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Notebook/" class="home-link router-link-active"><!----> <span class="site-name">Yolanda</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">ğŸ“æ—¥å¸¸è®°å½•</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">å¼€å‘è€…</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link router-link-active">ğŸ’»å¤§å‰ç«¯</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">ğŸ¤”å¤ç›˜</a></li><li class="dropdown-item"><h4>ï¸ï¸ğŸ§˜ç®—æ³•ä¿®ç‚¼</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/algorithm/computerBasics.html" class="nav-link">è®¡ç®—æœºåŸºç¡€</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">æ•°æ®ç»“æ„</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">ç®—æ³•åˆ†ç±»</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">æ•°æ®åº“</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">â˜ï¸è¿ç»´</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">ğŸš¬æµ‹è¯•</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">ğŸŒGIS</a></li><li class="dropdown-item"><!----> <a href="/Notebook/software/" class="nav-link">ï¸ï¸ğŸ–±ï¸è½¯ä»¶</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">ï¸ï¸ğŸ›ç½‘ç»œå·¥ç¨‹</a></li><li class="dropdown-item"><!----> <a href="/Notebook/csharp/" class="nav-link">ğŸš—C#</a></li><li class="dropdown-item"><!----> <a href="/Notebook/unity/" class="nav-link">ğŸ®Unity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">è®¾è®¡</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">ğŸ–Œï¸UI</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">ğŸ·ä¹¦ç­¾æ•´ç†</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">âœ”ï¸ç¼–ç è§„èŒƒ&amp;ååŒå¼€å‘</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“–çŸ¥è¯†è„‘å›¾
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://jecyu.github.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ”§ä¸ªäººåšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸ”—Github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Yolanda177" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Yolanda github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è‹±è¯­å­¦ä¹ 
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">ğŸ“æ—¥å¸¸è®°å½•</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">å¼€å‘è€…</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link router-link-active">ğŸ’»å¤§å‰ç«¯</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">ğŸ¤”å¤ç›˜</a></li><li class="dropdown-item"><h4>ï¸ï¸ğŸ§˜ç®—æ³•ä¿®ç‚¼</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/algorithm/computerBasics.html" class="nav-link">è®¡ç®—æœºåŸºç¡€</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">æ•°æ®ç»“æ„</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">ç®—æ³•åˆ†ç±»</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">æ•°æ®åº“</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">â˜ï¸è¿ç»´</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">ğŸš¬æµ‹è¯•</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">ğŸŒGIS</a></li><li class="dropdown-item"><!----> <a href="/Notebook/software/" class="nav-link">ï¸ï¸ğŸ–±ï¸è½¯ä»¶</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">ï¸ï¸ğŸ›ç½‘ç»œå·¥ç¨‹</a></li><li class="dropdown-item"><!----> <a href="/Notebook/csharp/" class="nav-link">ğŸš—C#</a></li><li class="dropdown-item"><!----> <a href="/Notebook/unity/" class="nav-link">ğŸ®Unity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">è®¾è®¡</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">ğŸ–Œï¸UI</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">ğŸ·ä¹¦ç­¾æ•´ç†</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">âœ”ï¸ç¼–ç è§„èŒƒ&amp;ååŒå¼€å‘</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ“–çŸ¥è¯†è„‘å›¾
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://jecyu.github.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ğŸ”§ä¸ªäººåšå®¢
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸ”—Github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Yolanda177" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Yolanda github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  è‹±è¯­å­¦ä¹ 
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>å‰ç«¯</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/frontend-web/browser.html" class="sidebar-link">æµè§ˆå™¨</a></li><li><a href="/Notebook/frontend-web/css.html" class="sidebar-link">CSS</a></li><li><a href="/Notebook/frontend-web/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/Notebook/frontend-web/es6.html" class="sidebar-link">ES6</a></li><li><a href="/Notebook/frontend-web/react.html" class="sidebar-link">React</a></li><li><a href="/Notebook/frontend-web/vue.html" class="active sidebar-link">Vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#vue3" class="sidebar-link">Vue3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#composition-api" class="sidebar-link">Composition API</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#vue2" class="sidebar-link">Vue2</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#åŸºç¡€" class="sidebar-link">åŸºç¡€</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#æ’æ§½" class="sidebar-link">æ’æ§½</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#transition-ä½¿ç”¨" class="sidebar-link">transition ä½¿ç”¨</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#ç»„ä»¶" class="sidebar-link">ç»„ä»¶</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#è‡ªå®šä¹‰æŒ‡ä»¤" class="sidebar-link">è‡ªå®šä¹‰æŒ‡ä»¤</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#vue-router" class="sidebar-link">vue-router</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#è¿›é˜¶" class="sidebar-link">è¿›é˜¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#inject-provideï¼ˆç»„ä»¶åº“ï¼‰" class="sidebar-link">inject/provideï¼ˆç»„ä»¶åº“ï¼‰</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#watch-é«˜çº§åº”ç”¨" class="sidebar-link">watch é«˜çº§åº”ç”¨</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#é¿å…æ€§èƒ½å¼€é”€ï¼Œåªç›‘å¬å¯¹è±¡é‡ŒæŒ‡å®šçš„å±æ€§" class="sidebar-link">é¿å…æ€§èƒ½å¼€é”€ï¼Œåªç›‘å¬å¯¹è±¡é‡ŒæŒ‡å®šçš„å±æ€§</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#åˆ©ç”¨-immediate-çš„åœºæ™¯" class="sidebar-link">åˆ©ç”¨ immediate çš„åœºæ™¯</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#ç»„ä»¶é€šä¿¡æ–¹å¼" class="sidebar-link">ç»„ä»¶é€šä¿¡æ–¹å¼</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#eventbus" class="sidebar-link">eventBus</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#attrsä¸-listeners" class="sidebar-link">$attrsä¸$listeners</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#vue-é€‰é¡¹åˆå¹¶ç­–ç•¥" class="sidebar-link">vue é€‰é¡¹åˆå¹¶ç­–ç•¥</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#æ¡†æ¶åŸç†" class="sidebar-link">æ¡†æ¶åŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#å“åº”å¼å¯¹è±¡" class="sidebar-link">å“åº”å¼å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#ä¾èµ–æ”¶é›†" class="sidebar-link">ä¾èµ–æ”¶é›†</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#æ´¾å‘æ›´æ–°" class="sidebar-link">æ´¾å‘æ›´æ–°</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#nexttick" class="sidebar-link">nextTick</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#vue-çš„-diff-ç®—æ³•" class="sidebar-link">vue çš„ diff ç®—æ³•</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#vue-ç»„ä»¶é‡ç½®çŠ¶æ€ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰" class="sidebar-link">vue ç»„ä»¶é‡ç½®çŠ¶æ€ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#å¸¸è§é—®é¢˜" class="sidebar-link">å¸¸è§é—®é¢˜</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#å­˜å‚¨è·¯ç”±å‚æ•°ï¼Œè§£å†³å­˜å‚¨-params-çš„åˆ·æ–°ä¸¢å¤±é—®é¢˜" class="sidebar-link">å­˜å‚¨è·¯ç”±å‚æ•°ï¼Œè§£å†³å­˜å‚¨ params çš„åˆ·æ–°ä¸¢å¤±é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#vue-å®ä¾‹åˆå§‹åŒ–" class="sidebar-link">Vue å®ä¾‹åˆå§‹åŒ–</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#æƒé™è·¯ç”±" class="sidebar-link">æƒé™è·¯ç”±</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#è®°å½•ç”¨æˆ·çš„å†å²é¡µé¢" class="sidebar-link">è®°å½•ç”¨æˆ·çš„å†å²é¡µé¢</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#åŒå‘ç»‘å®š" class="sidebar-link">åŒå‘ç»‘å®š</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/vue.html#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a></li></ul></li><li><a href="/Notebook/frontend-web/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/Notebook/frontend-web/" class="sidebar-link">å·¥ç¨‹åŒ–</a></li><li><a href="/Notebook/frontend-web/modulization.html" class="sidebar-link">æ¨¡å—åŒ–</a></li><li><a href="/Notebook/frontend-web/architecture.html" class="sidebar-link">æ¶æ„</a></li><li><a href="/Notebook/frontend-web/authentication.html" class="sidebar-link">é‰´æƒ&amp;&amp;è®¤è¯</a></li><li><a href="/Notebook/frontend-web/chrome.html" class="sidebar-link">chrome è°ƒè¯•æŠ€å·§</a></li><li><a href="/Notebook/frontend-web/noJQ.html" class="sidebar-link">You (Might) Don't Need jQuery</a></li><li><a href="/Notebook/frontend-web/performance.html" class="sidebar-link">æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="/Notebook/frontend-web/npm.html" class="sidebar-link">npm</a></li><li><a href="/Notebook/frontend-web/lodash.html" class="sidebar-link">lodash æºç åˆ†æåŠæ€è·¯å­¦ä¹ </a></li><li><a href="/Notebook/frontend-web/babel.html" class="sidebar-link">Babel</a></li><li><a href="/Notebook/frontend-web/rollup.html" class="sidebar-link">rollup</a></li><li><a href="/Notebook/frontend-web/docker.html" class="sidebar-link">Docker</a></li><li><a href="/Notebook/frontend-web/security.html" class="sidebar-link">å‰ç«¯å®‰å…¨</a></li><li><a href="/Notebook/frontend-web/file.html" class="sidebar-link">æ–‡ä»¶å¤„ç†</a></li><li><a href="/Notebook/frontend-web/interview.html" class="sidebar-link">å¸¸è§é—®é¢˜ 1</a></li><li><a href="/Notebook/frontend-web/interview2.html" class="sidebar-link">å¸¸è§é—®é¢˜ 2</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue"><a href="#vue" aria-hidden="true" class="header-anchor">#</a> Vue</h1> <h2 id="vue3"><a href="#vue3" aria-hidden="true" class="header-anchor">#</a> Vue3</h2> <h3 id="composition-api"><a href="#composition-api" aria-hidden="true" class="header-anchor">#</a> Composition API</h3> <h4 id="setup"><a href="#setup" aria-hidden="true" class="header-anchor">#</a> setup</h4> <p><em>setup(props, setupContext)</em> å‡½æ•°æ˜¯ Vue Composition API æ„å»ºçš„å‡½æ•°å¼å†™æ³•çš„ä¸»é€»è¾‘ï¼Œåœ¨åˆ›å»ºç»„ä»¶<strong>ä¹‹å‰</strong>æ‰§è¡Œã€‚</p> <h4 id="ç”Ÿå‘½å‘¨æœŸé’©å­å˜åŒ–"><a href="#ç”Ÿå‘½å‘¨æœŸé’©å­å˜åŒ–" aria-hidden="true" class="header-anchor">#</a> ç”Ÿå‘½å‘¨æœŸé’©å­å˜åŒ–</h4> <h4 id="reactive"><a href="#reactive" aria-hidden="true" class="header-anchor">#</a> reactive</h4> <h4 id="ref"><a href="#ref" aria-hidden="true" class="header-anchor">#</a> ref</h4> <h4 id="watch"><a href="#watch" aria-hidden="true" class="header-anchor">#</a> watch</h4> <h4 id="computed"><a href="#computed" aria-hidden="true" class="header-anchor">#</a> computed</h4> <h4 id="typescript-å’Œ-jsx-æ”¯æŒ"><a href="#typescript-å’Œ-jsx-æ”¯æŒ" aria-hidden="true" class="header-anchor">#</a> TypeScript å’Œ JSX æ”¯æŒ</h4> <h2 id="vue2"><a href="#vue2" aria-hidden="true" class="header-anchor">#</a> Vue2</h2> <p>ä»¥ä¸‹</p> <h2 id="åŸºç¡€"><a href="#åŸºç¡€" aria-hidden="true" class="header-anchor">#</a> åŸºç¡€</h2> <h3 id="æ’æ§½"><a href="#æ’æ§½" aria-hidden="true" class="header-anchor">#</a> æ’æ§½</h3> <blockquote><p>æ’æ§½ï¼Œä¹Ÿå°±æ˜¯ slotï¼Œæ˜¯ç»„ä»¶çš„ä¸€å— HTML æ¨¡ç‰ˆï¼Œè¿™å—æ¨¡ç‰ˆæ˜¾ç¤ºä¸æ˜¾ç¤ºã€ä»¥åŠæ€æ ·æ˜¾ç¤ºç”±çˆ¶ç»„ä»¶æ¥å†³å®šã€‚ä¸€ä¸ª slot çš„æ ¸å¿ƒä¸¤ä¸ªé—®é¢˜æ˜¯ï¼šæ˜¾ç¤ºä¸æ˜¾ç¤ºå’Œæ€æ ·æ˜¾ç¤ºã€‚</p></blockquote> <p>ç”±äºæ’æ§½æ˜¯ä¸€å—æ¨¡æ¿ï¼Œæ‰€ä»¥ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªç»„ä»¶ï¼Œä»æ¨¡æ¿ç§ç±»çš„è§’åº¦æ¥åˆ†ï¼Œå…¶å®éƒ½å¯ä»¥åˆ†ä¸ºéæ’æ§½æ¨¡æ¿å’Œæ’æ§½æ¨¡æ¿ä¸¤å¤§ç±»ã€‚
éæ’æ§½æ¨¡æ¿æŒ‡çš„æ˜¯ html æ¨¡æ¿ï¼Œæ¯”å¦‚â€˜divã€spanã€ulã€tableâ€™è¿™äº›ï¼Œéæ’æ§½æ¨¡æ¿çš„æ˜¾ç¤ºä¸éšè—ä»¥åŠæ€æ ·æ˜¾ç¤ºç”±ç»„ä»¶è‡ªèº«æ§åˆ¶ï¼›æ’æ§½æ¨¡æ¿æ˜¯ slotï¼Œå®ƒæ˜¯ä¸€ä¸ªç©ºå£³å­ï¼Œå› ä¸ºå®ƒçš„æ˜¾ç¤ºä¸éšè—ä»¥åŠæœ€åç”¨ä»€ä¹ˆæ ·çš„ html æ¨¡æ¿æ˜¾ç¤ºç”±çˆ¶ç»„ä»¶æ§åˆ¶ã€‚<strong>ä½†æ˜¯æ’æ§½æ˜¾ç¤ºçš„ä½ç½®å´ç”±å­ç»„ä»¶è‡ªèº«å†³å®šï¼Œslot å†™åœ¨ç»„ä»¶ template çš„ä»€ä¹ˆä½ç½®ï¼Œçˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„æ¨¡æ¿å°†æ¥å°±æ˜¾ç¤ºåœ¨ä»€ä¹ˆä½ç½®</strong></p> <h4 id="å•ä¸ªæ’æ§½-é»˜è®¤æ’æ§½-åŒ¿åæ’æ§½"><a href="#å•ä¸ªæ’æ§½-é»˜è®¤æ’æ§½-åŒ¿åæ’æ§½" aria-hidden="true" class="header-anchor">#</a> å•ä¸ªæ’æ§½ | é»˜è®¤æ’æ§½ | åŒ¿åæ’æ§½</h4> <p>å•ä¸ªæ’æ§½å¯ä»¥æ”¾ç½®åœ¨ç»„ä»¶çš„ä»»æ„ä½ç½®ï¼Œä½†æ˜¯å°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œä¸€ä¸ªç»„ä»¶ä¸­åªèƒ½æœ‰ä¸€ä¸ªè¯¥ç±»æ’æ§½ã€‚ç›¸å¯¹åº”çš„ï¼Œå…·åæ’æ§½å°±å¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œåªè¦åå­—ï¼ˆname å±æ€§ï¼‰ä¸åŒå°±å¯ä»¥äº†ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// child</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Child'</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;child&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>è¿™é‡Œæ˜¯å­ç»„ä»¶<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/* &lt;slot /&gt; */</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// template å†™æ³•</span>
<span class="token comment">//   &lt;template&gt;</span>
<span class="token comment">//   &lt;div class='wrapper'&gt;</span>
<span class="token comment">//     &lt;span&gt;I am a component&lt;/span&gt;</span>
<span class="token comment">//     &lt;slot&gt;&lt;/slot&gt;</span>
<span class="token comment">//     &lt;slot name='namedSlot'&gt;&lt;/slot&gt;</span>
<span class="token comment">//   &lt;/div&gt;</span>
<span class="token comment">// &lt;/template&gt;</span>

<span class="token comment">// // main.vue</span>
<span class="token comment">// &lt;template&gt;</span>
<span class="token comment">//   &lt;wrapper&gt;</span>
<span class="token comment">//     &lt;div&gt;</span>
<span class="token comment">//       I am the slot</span>
<span class="token comment">//     &lt;/div&gt;</span>

<span class="token comment">//     &lt;div slot='namedSlot'&gt;I am the named slot&lt;/div&gt;</span>
<span class="token comment">//   &lt;/wrapper&gt;</span>
<span class="token comment">// &lt;/template&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// parent</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;default-wrapper&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Vue å•ä¸ªæ’æ§½<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Child1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;tmpl&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">4</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Child1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><h4 id="å…·åæ’æ§½"><a href="#å…·åæ’æ§½" aria-hidden="true" class="header-anchor">#</a> å…·åæ’æ§½</h4> <p>åŒ¿åæ’æ§½æ²¡æœ‰ name å±æ€§ï¼Œæ‰€ä»¥æ˜¯åŒ¿åæ’æ§½ï¼Œé‚£ä¹ˆï¼Œæ’æ§½åŠ äº† name å±æ€§ï¼Œå°±å˜æˆäº†å…·åæ’æ§½ã€‚å…·åæ’æ§½å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å‡ºç° N æ¬¡ï¼Œå‡ºç°åœ¨ä¸åŒçš„ä½ç½®ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Child'</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;child&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>è¿™é‡Œæ˜¯å­ç»„ä»¶<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/* &lt;slot /&gt; */</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token comment">/* å…·åæ’æ§½ */</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>up<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// parent</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;named-wrapper&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Vue å…·åæ’æ§½<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Child2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;tmpl&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;up&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>èœå•<span class="token number">4</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Child2<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><h4 id="ä½œç”¨åŸŸæ’æ§½"><a href="#ä½œç”¨åŸŸæ’æ§½" aria-hidden="true" class="header-anchor">#</a> ä½œç”¨åŸŸæ’æ§½</h4> <p>ä½œç”¨åŸŸæ’æ§½è·Ÿå•ä¸ªæ’æ§½å’Œå…·åæ’æ§½çš„åŒºåˆ«ï¼Œå› ä¸ºå•ä¸ªæ’æ§½å’Œå…·åæ’æ§½ä¸ç»‘å®šæ•°æ®ï¼Œè€Œä½œç”¨åŸŸæ’æ§½ï¼Œçˆ¶ç»„ä»¶åªéœ€è¦æä¾›ä¸€å¥—æ ·å¼ï¼ˆåœ¨ç¡®å®ç”¨ä½œç”¨åŸŸæ’æ§½ç»‘å®šçš„æ•°æ®çš„å‰æä¸‹ï¼‰ï¼Œæ•°æ®ä½¿ç”¨çš„éƒ½æ˜¯å­ç»„ä»¶æ’æ§½è‡ªå·±ç»‘å®šçš„ s æ•°æ®ï¼Œåœ¨ slot ä¸Šé¢ç»‘å®šæ•°æ®ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Child'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'java'</span><span class="token punctuation">,</span> <span class="token string">'c++'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;child&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>è¿™é‡Œæ˜¯å­ç»„ä»¶<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token comment">/* &lt;slot /&gt; */</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token comment">/* å…·åæ’æ§½ */</span><span class="token punctuation">}</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          data<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Template å†™æ³•</span>
<span class="token comment">// Child.vue</span>
<span class="token comment">//   &lt;template&gt;</span>
<span class="token comment">//   &lt;div class='wrapper'&gt;</span>
<span class="token comment">//     &lt;span&gt;I am a component&lt;/span&gt;</span>
<span class="token comment">//     &lt;slot :data='data'&gt;&lt;/slot&gt;</span>
<span class="token comment">//   &lt;/div&gt;</span>
<span class="token comment">// &lt;/template&gt;</span>

<span class="token comment">// // main.vue</span>
<span class="token comment">// &lt;template&gt;</span>
<span class="token comment">//   &lt;wrapper&gt;</span>
<span class="token comment">//     &lt;div slot-scope='{ data }'&gt;</span>
<span class="token comment">//     &lt;/div&gt;</span>
<span class="token comment">//   &lt;/wrapper&gt;</span>
<span class="token comment">// &lt;/template&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// parent</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;slot-scoped&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Vue ä½œç”¨åŸŸæ’æ§½ <span class="token operator">|</span> å¸¦æ•°æ®çš„æ’æ§½<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Child3<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;tmpl&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;up&quot;</span> slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;user&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token punctuation">{</span> user<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Child3<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><h3 id="transition-ä½¿ç”¨"><a href="#transition-ä½¿ç”¨" aria-hidden="true" class="header-anchor">#</a> transition ä½¿ç”¨</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- ä¸Šä¼ é¡µé¢ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">enter-active-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fadeIn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">leave-active-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fadeOut<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UploadFile</span>
    <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modalStatus.isShowUploadModal<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modalStatus.isShowUploadModal = false<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UploadFile</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.fadeIn</span> <span class="token punctuation">{</span>
  <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.2s linear<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.fadeOut</span> <span class="token punctuation">{</span>
  <span class="token property">animation</span><span class="token punctuation">:</span> fadeIn 0.2s linear<span class="token punctuation">;</span>
  <span class="token property">animation-direction</span><span class="token punctuation">:</span> reverse<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@keyframes</span> fadeIn</span> <span class="token punctuation">{</span>
  <span class="token selector">0%</span> <span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>0.9<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">100%</span> <span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ç»„ä»¶"><a href="#ç»„ä»¶" aria-hidden="true" class="header-anchor">#</a> ç»„ä»¶</h3> <h3 id="è‡ªå®šä¹‰æŒ‡ä»¤"><a href="#è‡ªå®šä¹‰æŒ‡ä»¤" aria-hidden="true" class="header-anchor">#</a> è‡ªå®šä¹‰æŒ‡ä»¤</h3> <h3 id="vue-router"><a href="#vue-router" aria-hidden="true" class="header-anchor">#</a> vue-router</h3> <h4 id="vue-è·¯ç”±-æŒ‰éœ€-keep-alive"><a href="#vue-è·¯ç”±-æŒ‰éœ€-keep-alive" aria-hidden="true" class="header-anchor">#</a> vue è·¯ç”± æŒ‰éœ€ keep-alive</h4> <ul><li>https://juejin.im/post/5cdcbae9e51d454759351d84#heading-4</li></ul> <h4 id="è·å–è·¯ç”±æ–‡ä»¶"><a href="#è·å–è·¯ç”±æ–‡ä»¶" aria-hidden="true" class="header-anchor">#</a> è·å–è·¯ç”±æ–‡ä»¶</h4> <p>è·å–é…ç½®çš„è·¯ç”±</p> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span>$router<span class="token punctuation">.</span>options<span class="token punctuation">.</span>routes<span class="token punctuation">;</span>
</code></pre></div><h2 id="è¿›é˜¶"><a href="#è¿›é˜¶" aria-hidden="true" class="header-anchor">#</a> è¿›é˜¶</h2> <h3 id="inject-provideï¼ˆç»„ä»¶åº“ï¼‰"><a href="#inject-provideï¼ˆç»„ä»¶åº“ï¼‰" aria-hidden="true" class="header-anchor">#</a> inject/provideï¼ˆç»„ä»¶åº“ï¼‰</h3> <h4 id="provide"><a href="#provide" aria-hidden="true" class="header-anchor">#</a> provide</h4> <p>è¿™ä¸ªç©æ„æ˜¯æä¾›ç»™ç»„ä»¶åº“ç”¨çš„ï¼Œç»„ä»¶åº“æ˜¯æ²¡æ³•ç”¨ vuexï¼Œvue å®˜æ–¹æ‰æä¾›ä¸ª provideï¼Œæˆ‘ä»¬ç”¨äº† vuex å°±ä¸éœ€è¦è¿™ä¸ªäº†ã€‚</p> <h3 id="watch-é«˜çº§åº”ç”¨"><a href="#watch-é«˜çº§åº”ç”¨" aria-hidden="true" class="header-anchor">#</a> watch é«˜çº§åº”ç”¨</h3> <h3 id="é¿å…æ€§èƒ½å¼€é”€ï¼Œåªç›‘å¬å¯¹è±¡é‡ŒæŒ‡å®šçš„å±æ€§"><a href="#é¿å…æ€§èƒ½å¼€é”€ï¼Œåªç›‘å¬å¯¹è±¡é‡ŒæŒ‡å®šçš„å±æ€§" aria-hidden="true" class="header-anchor">#</a> é¿å…æ€§èƒ½å¼€é”€ï¼Œåªç›‘å¬å¯¹è±¡é‡ŒæŒ‡å®šçš„å±æ€§</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åªè¦ç­›é€‰é‡Œçš„è¯·æ±‚å‚æ•°å˜åŒ–ï¼Œå°±é‡æ–°æŸ¥è¯¢ï¼Œä¸ç”¨æ‰‹åŠ¨ç‚¹å‡»æŸ¥è¯¢</span>
  <span class="token string">&quot;queryParams.queryMap&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>queryResult <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>indicator <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>indicator<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    deep<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="åˆ©ç”¨-immediate-çš„åœºæ™¯"><a href="#åˆ©ç”¨-immediate-çš„åœºæ™¯" aria-hidden="true" class="header-anchor">#</a> åˆ©ç”¨ immediate çš„åœºæ™¯</h3> <h4 id="åœºæ™¯ä¸€"><a href="#åœºæ™¯ä¸€" aria-hidden="true" class="header-anchor">#</a> åœºæ™¯ä¸€</h4> <p>ï¼Ÿï¼Ÿï¼Ÿ</p> <p>å› ä¸ºï¼šProps -ã€‹ Methods -ã€‹ Data -ã€‹Computed -ã€‹
æ‰€ä»¥åœ¨åˆå§‹åŒ–ç»„ä»¶è¿˜æ²¡æ·»åŠ è¿›å»æ—¶ï¼Œæ­¤æ—¶ watch æ˜¯å¦å°±éœ€è¦å¤„ç†</p> <p>çˆ¶ç»„ä»¶åˆå§‹åŒ– <code>queryResult</code> éƒ½ä¸ºç©ºï¼Œç„¶åå¼‚æ­¥èµ‹å€¼ç»™å­ç»„ä»¶ã€‚å­ç»„ä»¶ä¼š<code>watch</code></p> <p>åŒºåˆ«æ˜¯ç»„ä»¶çš„ vif æ˜¯å¦ä½¿ç”¨ props çš„æ•°æ®</p> <p>è¿™é‡Œç”¨ v-ifï¼Œä»å¤´åˆ°å°¾å°±æ˜¯ queryResult å¤„ç†åçš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ <code>immediate</code> æ‰èƒ½è°ƒç”¨æ•°æ®</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>PreviewTable v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;Object.keys(queryResult).length &gt; 0&quot;</span> <span class="token punctuation">:</span>queryParams<span class="token operator">=</span><span class="token string">&quot;queryParam&quot;</span> <span class="token punctuation">:</span>resultData<span class="token operator">=</span><span class="token string">&quot;queryResult&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>PreviewTable<span class="token operator">&gt;</span>
</code></pre></div><p>è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ vifï¼Œ</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;result&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Spin v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;isShowLoading&quot;</span> fix<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Spin<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>ResultReview <span class="token punctuation">:</span>resultData<span class="token operator">=</span><span class="token string">&quot;queryResult&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>ResultReview<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><h4 id="åœºæ™¯äºŒ"><a href="#åœºæ™¯äºŒ" aria-hidden="true" class="header-anchor">#</a> åœºæ™¯äºŒ</h4> <p>ä»å…¶ä»–ç»„ä»¶ï¼Œè·¯ç”±ç›´æ¥è·³è½¬è¿‡æ¥çš„æ•°æ®ã€è§†å›¾æ›´æ–°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  defaultIndexDataCondition<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handler</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">viewHistory</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    deep<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token comment">// immdiate ä»£æ›¿äº† create çš„æ›´æ–°ï¼Œvue æºç æ€ä¹ˆè¯´ï¼Œç”Ÿå‘½å‘¨æœŸ</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getIndicatorSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexSystems <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>value <span class="token operator">=</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>label <span class="token operator">=</span> item<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿‡æ»¤é»˜è®¤å€¼</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultIndexDataCondition<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">viewHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultIndexDataCondition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="ç»„ä»¶é€šä¿¡æ–¹å¼"><a href="#ç»„ä»¶é€šä¿¡æ–¹å¼" aria-hidden="true" class="header-anchor">#</a> ç»„ä»¶é€šä¿¡æ–¹å¼</h3> <ul><li>props/$emit</li> <li>$children/$parent</li> <li>provide/inject</li> <li>ref</li> <li>eventBus</li> <li>Vuex</li> <li>localStorage/seeionStorage</li> <li>$attrsä¸$listeners</li></ul> <h3 id="eventbus"><a href="#eventbus" aria-hidden="true" class="header-anchor">#</a> eventBus</h3> <h4 id="é€‚ç”¨"><a href="#é€‚ç”¨" aria-hidden="true" class="header-anchor">#</a> é€‚ç”¨</h4> <p>å°æ•°æ®é‡çš„ä¼ è¾“ï¼Œç¼ºç‚¹ï¼ševentBus å¤ªå¤šä¹Ÿä¹±ã€‚</p> <h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" aria-hidden="true" class="header-anchor">#</a> åˆå§‹åŒ–</h4> <h4 id="å‘é€äº‹ä»¶"><a href="#å‘é€äº‹ä»¶" aria-hidden="true" class="header-anchor">#</a> å‘é€äº‹ä»¶</h4> <div class="language-js extra-class"><pre class="language-js"><code>EventBus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'setFeatureLegend'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">,</span>
  deg<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deg
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="æ¥æ”¶äº‹ä»¶"><a href="#æ¥æ”¶äº‹ä»¶" aria-hidden="true" class="header-anchor">#</a> æ¥æ”¶äº‹ä»¶</h4> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;setFeatureLegend&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>setFeatureLegend<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">&quot;setFeatureLegend&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>setFeatureLegend<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="provide-inject"><a href="#provide-inject" aria-hidden="true" class="header-anchor">#</a> provide/inject</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æŠŠ mapã€mapView æ³¨å…¥åˆ°å­ç»„ä»¶ä¸­</span>
<span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">,</span>
    mapView<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapView<span class="token punctuation">,</span>
    eventBus<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventBus<span class="token punctuation">,</span>
    shadowMapView<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowMapView<span class="token punctuation">,</span>
    curSubSystemName<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="attrsä¸-listeners"><a href="#attrsä¸-listeners" aria-hidden="true" class="header-anchor">#</a> $attrsä¸$listeners</h3> <h3 id="vue-é€‰é¡¹åˆå¹¶ç­–ç•¥"><a href="#vue-é€‰é¡¹åˆå¹¶ç­–ç•¥" aria-hidden="true" class="header-anchor">#</a> vue é€‰é¡¹åˆå¹¶ç­–ç•¥</h3> <p>å½“ä½¿ç”¨ Vue çš„<strong>mixins</strong>æ—¶ï¼Œä¼šå‘ç°ä¸åŒçš„é€‰é¡¹ä¼šæœ‰ä¸åŒçš„åˆå¹¶ç­–ç•¥ï¼š</p> <ul><li>dataã€propsã€methods å±äº<strong>åŒåå±æ€§è¢«ç»„ä»¶è¦†ç›–åˆå¹¶</strong></li> <li>ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å±äº<strong>ç›´æ¥åˆå¹¶</strong>ï¼Œæ‰§è¡Œé¡ºåºæ˜¯<strong>å…ˆæ··å…¥åç»„ä»¶</strong></li></ul> <p>è€Œ Vue ä¸­æä¾›äº†è¿™æ ·ä¸€ä¸ª API ï¼š<strong>Vue.config.optionMergeStrategies</strong>ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ª API è‡ªå®šä¹‰æˆ‘ä»¬éœ€è¦çš„åˆå¹¶ç­–ç•¥</p> <p>åº”ç”¨åœºæ™¯ï¼šå½“ç³»ç»Ÿé¡µé¢æœ‰å­˜åœ¨è½®è¯¢æˆ–åŠ¨ç”»æ—¶ï¼Œæ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨é¡µç­¾ä¸ä¼šæœ‰å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼›ä½†æ‰“å¼€çš„é¡µç­¾å¤šäº†ï¼Œæµè§ˆå™¨å°±ä¼šå˜å¾—å¡é¡¿ï¼›æœ‰æ²¡æœ‰èƒ½ç›‘å¬æµè§ˆå™¨é¡µç­¾æ˜¯å¦æ˜¾ç¤ºçš„æ–¹æ³•å‘¢ï¼Ÿæœ‰çš„ï¼š<strong>visibilityChange</strong></p> <p>demo:</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTimer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>

    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleVisibilityChange<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleVisibilityChang</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>visibilityState <span class="token operator">===</span> <span class="token string">'hidden'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hidden'</span><span class="token punctuation">)</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refreshTimer<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTimer <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>visibilityState <span class="token operator">===</span> <span class="token string">'visible'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'visible'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>refreshTimer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>refreshTimer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>å½“åˆ‡æ¢æµè§ˆå™¨æ ‡ç­¾æ—¶ï¼š</p> <p><img src="/Notebook/assets/img/visibleChange.ad11597e.png" alt=""></p> <p>å¦‚æœåœ¨æ¯ä¸€ä¸ªéœ€è¦ç›‘å¬å¤„ç†çš„æ–‡ä»¶ä¸Šå†™ä¸€å †çš„äº‹ä»¶ç›‘å¬ï¼Œå»åˆ¤æ–­é¡µé¢æ˜¯å¦æ˜¾ç¤ºï¼Œæ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼›è¿™æ—¶ï¼Œå¦‚æœèƒ½å®šä¹‰ä¸€ä¸ªé¡µé¢æ˜¾ç¤ºéšè—çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ŒæŠŠè¿™äº›åˆ¤æ–­å°è£…èµ·æ¥ï¼Œå°±éå¸¸é«˜æ•ˆï¼š</p> <p>demo:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// initLifeCycle.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token comment">// é€šçŸ¥æ‰€æœ‰ç»„ä»¶é¡µé¢çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–</span>
<span class="token keyword">const</span> <span class="token function-variable function">notifyVisibilityChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">lifeCycleName<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¼šå­˜åœ¨$optionsä¸­ï¼Œé€šè¿‡$options[lifeCycleName]è·å–ç”Ÿå‘½å‘¨æœŸ</span>
  <span class="token keyword">const</span> lifeCycles <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">[</span>lifeCycleName<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// å› ä¸ºä½¿ç”¨äº†createdçš„åˆå¹¶ç­–ç•¥ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„</span>
  lifeCycles <span class="token operator">&amp;&amp;</span>
    lifeCycles<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
    lifeCycles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">lifecycle</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// éå† lifeCycleNameå¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°åˆ—è¡¨ï¼Œä¾æ¬¡æ‰§è¡Œ</span>
      <span class="token function">lifecycle</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  vm<span class="token punctuation">.</span>$children <span class="token operator">&amp;&amp;</span>
    vm<span class="token punctuation">.</span>$children<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
    vm<span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// éå†æ‰€æœ‰çš„å­ç»„ä»¶ï¼Œç„¶åä¾æ¬¡é€’å½’æ‰§è¡Œ</span>
      <span class="token function">notifyVisibilityChange</span><span class="token punctuation">(</span>lifeCycleName<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * æ·»åŠ ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°
 * @param {*} rootVm vue æ ¹å®ä¾‹ï¼Œåœ¨é¡µé¢æ˜¾ç¤ºéšè—æ—¶å€™ï¼Œé€šè¿‡rootå‘ä¸‹é€šçŸ¥
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initLifeCycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> optionMergeStrategies <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">.</span>config<span class="token punctuation">;</span>
  <span class="token comment">/*
    å®šä¹‰äº†ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•° pageVisible, pageHidden
    ä¸ºä»€ä¹ˆè¦èµ‹å€¼ä¸º optionMergeStrategies.createdå‘¢
    è¿™ä¸ªç›¸å½“äºæŒ‡å®š pageVisible, pageHidden çš„åˆå¹¶ç­–ç•¥ä¸ createdçš„ç›¸åŒï¼ˆå…¶ä»–ç”Ÿå‘½å‘¨æœŸå‡½æ•°éƒ½ä¸€æ ·ï¼‰
   */</span>
  optionMergeStrategies<span class="token punctuation">.</span>pageVisible <span class="token operator">=</span> optionMergeStrategies<span class="token punctuation">.</span>beforeCreate<span class="token punctuation">;</span>
  optionMergeStrategies<span class="token punctuation">.</span>pageHidden <span class="token operator">=</span> optionMergeStrategies<span class="token punctuation">.</span>created<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * å°†äº‹ä»¶å˜åŒ–ç»‘å®šåˆ°æ ¹èŠ‚ç‚¹ä¸Šé¢
 * @param {*} rootVm
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">rootVm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ¤æ–­è°ƒç”¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°</span>
    <span class="token keyword">let</span> lifeCycleName<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>visibilityState <span class="token operator">===</span> <span class="token string">'hidden'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      lifeCycleName <span class="token operator">=</span> <span class="token string">'pageHidden'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>visibilityState <span class="token operator">===</span> <span class="token string">'visible'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      lifeCycleName <span class="token operator">=</span> <span class="token string">'pageVisible'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lifeCycleName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// é€šè¿‡æ‰€æœ‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿå˜åŒ–äº†</span>
      <span class="token function">notifyVisibilityChange</span><span class="token punctuation">(</span>lifeCycleName<span class="token punctuation">,</span> rootVm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨ main.js ä½¿ç”¨ï¼Œ<strong>æ³¨æ„</strong>ï¼Œéœ€è¦åœ¨ Vue å®ä¾‹åŒ–å‰è°ƒç”¨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'@/App.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'@/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> initLifeCycle<span class="token punctuation">,</span> bind <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/test'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'@/register'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token function">initLifeCycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">bind</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>optionMergeStrategies<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¿™å°±æ˜¯å®šä¹‰åçš„ vue ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼š</p> <p><img src="/Notebook/assets/img/optionMessage.b3c0cccc.png" alt=""></p> <h2 id="æ¡†æ¶åŸç†"><a href="#æ¡†æ¶åŸç†" aria-hidden="true" class="header-anchor">#</a> æ¡†æ¶åŸç†</h2> <h3 id="å“åº”å¼å¯¹è±¡"><a href="#å“åº”å¼å¯¹è±¡" aria-hidden="true" class="header-anchor">#</a> å“åº”å¼å¯¹è±¡</h3> <h4 id="proxy-å®ç°åŒå‘ç»‘å®š"><a href="#proxy-å®ç°åŒå‘ç»‘å®š" aria-hidden="true" class="header-anchor">#</a> proxy å®ç°åŒå‘ç»‘å®š</h4> <p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯·è¾“å…¥:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>input<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">getting </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      input<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
      p<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  newObj<span class="token punctuation">.</span>text <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="proxy"><a href="#proxy" aria-hidden="true" class="header-anchor">#</a> proxy</h4> <p>ä»£ç† <code>vm._props.xxx</code> to <code>vm.xxx</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> noop<span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">:</span> noop
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">:</span> Object<span class="token punctuation">,</span> sourceKey<span class="token punctuation">:</span> string<span class="token punctuation">,</span> key<span class="token punctuation">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="observe"><a href="#observe" aria-hidden="true" class="header-anchor">#</a> observe</h4> <p><code>observe</code> çš„åŠŸèƒ½å°±æ˜¯ç”¨æ¥ç›‘æµ‹æ•°æ®çš„å˜åŒ–ï¼Œå®ƒçš„å®šä¹‰æ—¶åœ¨ <code>src/core/observer/index.js</code> ä¸­</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Attempt to create an observer instance for a value,
 * returns the new observer if successfully observed,
 * or the existing observer if the value already has one.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> any<span class="token punctuation">,</span> asRootData<span class="token punctuation">:</span> <span class="token operator">?</span>boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value <span class="token keyword">instanceof</span> <span class="token class-name">VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> ob<span class="token punctuation">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__ob__ <span class="token keyword">instanceof</span> <span class="token class-name">Observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> value<span class="token punctuation">.</span>__ob__<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
    shouldObserve <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token function">isServerRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span>value<span class="token punctuation">.</span>_isVue
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asRootData <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob<span class="token punctuation">.</span>vmCount<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ob<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>observe</code> çš„æ–¹æ³•çš„ä½œç”¨å°±æ˜¯ç»™é VNode çš„å¯¹è±¡ç±»å‹æ•°æ®æ·»åŠ ä¸€ä¸ª <code>Observer</code>ï¼Œå¦‚æœå·²ç»æ·»åŠ è¿‡åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶ä¸‹å»å®ä¾‹åŒ–ä¸€ä¸ª <code>Observer</code> çš„å¯¹è±¡å®ä¾‹ã€‚</p> <h4 id="observer"><a href="#observer" aria-hidden="true" class="header-anchor">#</a> Observer</h4> <p><code>Observer</code> æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»™å¯¹è±¡çš„å±æ€§æ·»åŠ  getter å’Œ setterï¼Œç”¨äºä¾èµ–æ”¶é›†å’Œæ´¾å‘æ›´æ–°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Observer class that is attached to each observed
 * object. Once attached, the observer converts the target
 * object's property keys into getter/setters that
 * collect dependencies and dispatch updates.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> any<span class="token punctuation">;</span>
  dep<span class="token punctuation">:</span> Dep<span class="token punctuation">;</span>
  vmCount<span class="token punctuation">:</span> number<span class="token punctuation">;</span> <span class="token comment">// number of vms that has this object as root $data</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">def</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">'__ob__'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> augment <span class="token operator">=</span> hasProto <span class="token operator">?</span> protoAugment <span class="token punctuation">:</span> copyAugment<span class="token punctuation">;</span>
      <span class="token function">augment</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> arrayMethods<span class="token punctuation">,</span> arrayKeys<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Walk through each property and convert them into
   * getter/setters. This method should only be called when
   * value type is Object.
   */</span>
  <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Observe a list of Array items.
   */</span>
  <span class="token function">observeArray</span><span class="token punctuation">(</span><span class="token parameter">items<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Observer</code> çš„æ„é€ å‡½æ•°é€»è¾‘å¾ˆç®€å•ï¼Œé¦–å…ˆå®ä¾‹åŒ– <code>Dep</code> å¯¹è±¡ï¼Œæ¥ç€é€šè¿‡æ‰§è¡Œ <code>def</code> å‡½æ•°æŠŠè‡ªèº«å®ä¾‹æ·»åŠ åˆ°æ•°æ®å¯¹è±¡ <code>value</code> çš„ <code>__ob__</code> å¯¹è±¡ä¸Šã€‚<code>def</code> çš„å®šä¹‰åœ¨ <code>src/core/util/lang.js</code> ä¸­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Define a property.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">def</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">:</span> Object<span class="token punctuation">,</span> key<span class="token punctuation">:</span> string<span class="token punctuation">,</span> val<span class="token punctuation">:</span> any<span class="token punctuation">,</span> enumerable<span class="token operator">?</span><span class="token punctuation">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> val<span class="token punctuation">,</span>
    enumerable<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>def</code> å‡½æ•°æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ <code>Object.defineProperty</code> çš„å°è£…ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å¼€å‘ä¸­è¾“å‡º <code>data</code> ä¸Šå¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œä¼šå‘ç°è¯¥å¯¹è±¡å¤šäº†ä¸€ä¸ª <code>__ob__</code> çš„å±æ€§ã€‚</p> <p>å›åˆ° <code>Observer</code> çš„æ„é€ å‡½æ•°ï¼Œæ¥ä¸‹æ¥ä¼šå¯¹ <code>value</code> åšåˆ¤æ–­ï¼Œå¯¹äºæ•°ç»„ä¼šè°ƒç”¨ <code>observerArray</code> æ–¹æ³•ï¼Œå¦åˆ™å¯¹çº¯å¯¹è±¡è°ƒç”¨ <code>walk</code> æ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ° <code>observeArray</code> æ˜¯éå†æ•°ç»„å†æ¬¡è°ƒç”¨ <code>observe</code> æ–¹æ³•ï¼Œè€Œ <code>walk</code> æ–¹æ³•æ˜¯éå†å¯¹è±¡çš„ key è°ƒç”¨ <code>defineReactive</code> æ–¹æ³•ã€‚</p> <p><img src="/Notebook/assets/img/vue-observer.0fe102f7.png" alt=""></p> <h4 id="definereactive"><a href="#definereactive" aria-hidden="true" class="header-anchor">#</a> defineReactive</h4> <p><code>defineReactive</code> çš„åŠŸèƒ½å°±æ˜¯å®šä¹‰ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œç»™å¯¹è±¡åŠ¨æ€æ·»åŠ  getter å’Œ setterï¼Œå®ƒçš„å®šä¹‰åœ¨ <code>src/core/observer/index.js</code>ä¸­ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Define a reactive property on an Object.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>
  <span class="token parameter">obj<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  val<span class="token punctuation">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token punctuation">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// cater for pre-defined getter/setters</span>
  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>get<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>set<span class="token punctuation">;</span>

  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span> val<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span> val<span class="token punctuation">;</span>
      <span class="token comment">/* eslint-disable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* eslint-enable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>defineReactive</code> å‡½æ•°æœ€å¼€å§‹åˆå§‹åŒ– <code>Dep</code> å¯¹è±¡çš„å®ä¾‹ï¼Œæ¥ç€æ‹¿åˆ° <code>obj</code> çš„å±æ€§æè¿°ç¬¦ï¼Œç„¶åå¯¹å­å¯¹è±¡é€’å½’è°ƒç”¨ <code>observe</code> æ–¹æ³•ï¼Œè¿™æ ·å°±ä¿è¯äº†æ— è®º <code>obj</code> çš„ç»“æ„å¤šå¤æ‚ï¼Œå®ƒçš„æ‰€æœ‰å­å±æ€§ä¹Ÿèƒ½å˜æˆå“åº”å¼çš„å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬è®¿é—®æˆ–ä¿®æ”¹ <code>obj</code> ä¸­çš„ä¸€ä¸ªåµŒå¥—æ¯”è¾ƒæ·±çš„å±æ€§ï¼Œä¹Ÿèƒ½è§¦å‘ getter å’Œ setterã€‚æœ€ååˆ©ç”¨ <code>Object.defineProperty</code> å»ç»™ <code>obj</code> çš„å±æ€§æ·»åŠ  getter å’Œ setterã€‚</p> <p><img src="/Notebook/assets/img/vue-reactiveObj-defineReactive.4df16b5e.png" alt=""></p> <h4 id="æ€»ç»“"><a href="#æ€»ç»“" aria-hidden="true" class="header-anchor">#</a> æ€»ç»“</h4> <p>å“åº”å¼å¯¹è±¡æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨ <code>Object.defineProperty</code> ç»™æ•°æ®æ·»åŠ äº† getter å’Œ setterï¼Œç›®çš„å°±æ˜¯ä¸ºäº†åœ¨æˆ‘ä»¬è®¿é—®æ•°æ®ä»¥åŠå†™æ•°æ®çš„æ—¶å€™èƒ½è‡ªåŠ¨æ‰§è¡Œä¸€äº›é€»è¾‘ï¼šgetter åšçš„äº‹æƒ…æ˜¯ä¾èµ–æ”¶é›†ï¼Œsetter åšçš„äº‹æƒ…å°±æ˜¯æ´¾å‘æ›´æ–°ã€‚</p> <p>å‡½æ•°è°ƒç”¨æµç¨‹ï¼š
<code>initSate -&gt; observe -&gt; observer -&gt; defineReactive</code></p> <h3 id="ä¾èµ–æ”¶é›†"><a href="#ä¾èµ–æ”¶é›†" aria-hidden="true" class="header-anchor">#</a> ä¾èµ–æ”¶é›†</h3> <h4 id="dep"><a href="#dep" aria-hidden="true" class="header-anchor">#</a> Dep</h4> <p><code>Dep</code> æ˜¯æ•´ä¸ª getter ä¾èµ–æ”¶é›†çš„æ ¸å¿ƒï¼Œå®ƒçš„å®šä¹‰åœ¨ <code>src/core/observer/dep.js</code> ä¸­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> type Watcher <span class="token keyword">from</span> <span class="token string">'./watcher'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> remove <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../util/index'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> uid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * A dep is an observable that can have multiple
 * directives subscribing to it.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> target<span class="token punctuation">:</span> <span class="token operator">?</span>Watcher<span class="token punctuation">;</span>
  id<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  subs<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Watcher<span class="token operator">&gt;</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> uid<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">sub<span class="token punctuation">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token parameter">sub<span class="token punctuation">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// stabilize the subscriber list first</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// the current target watcher being evaluated.</span>
<span class="token comment">// this is globally unique because there could be only one</span>
<span class="token comment">// watcher being evaluated at any time.</span>
Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> targetStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token parameter">_target<span class="token punctuation">:</span> <span class="token operator">?</span>Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> targetStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> _target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> targetStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="watcher"><a href="#watcher" aria-hidden="true" class="header-anchor">#</a> Watcher</h4> <p><code>Watcher</code> åœ¨è¿™é‡Œèµ·åˆ°ä¸¤ä¸ªä½œç”¨ï¼Œä¸€ä¸ªæ˜¯åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯å½“ vm å®ä¾‹ä¸­çš„ç›‘æµ‹çš„æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">:</span> Component<span class="token punctuation">;</span>
  expression<span class="token punctuation">:</span> string<span class="token punctuation">;</span>
  cb<span class="token punctuation">:</span> Function<span class="token punctuation">;</span>
  id<span class="token punctuation">:</span> number<span class="token punctuation">;</span>
  deep<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  user<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  lazy<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  sync<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  dirty<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  active<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span>
  deps<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Dep<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  newDeps<span class="token punctuation">:</span> Array<span class="token operator">&lt;</span>Dep<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  depIds<span class="token punctuation">:</span> SimpleSet<span class="token punctuation">;</span>
  newDepIds<span class="token punctuation">:</span> SimpleSet<span class="token punctuation">;</span>
  getter<span class="token punctuation">:</span> Function<span class="token punctuation">;</span>
  value<span class="token punctuation">:</span> any<span class="token punctuation">;</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter">vm<span class="token punctuation">:</span> Component<span class="token punctuation">,</span>
    expOrFn<span class="token punctuation">:</span> string <span class="token operator">|</span> Function<span class="token punctuation">,</span>
    cb<span class="token punctuation">:</span> Function<span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
    isRenderWatcher<span class="token operator">?</span><span class="token punctuation">:</span> boolean</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isRenderWatcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vm<span class="token punctuation">.</span>_watcher <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
    vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token comment">// options</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deep <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>deep
      <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>user
      <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>lazy
      <span class="token keyword">this</span><span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>sync
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">++</span>uid <span class="token comment">// uid for batching</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy <span class="token comment">// for lazy watchers</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>expression <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>
      <span class="token operator">?</span> expOrFn<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token comment">// parse expression for getter</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> expOrFn <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> expOrFn
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> <span class="token function">parsePath</span><span class="token punctuation">(</span>expOrFn<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>getter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Failed watching path: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expOrFn<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
          <span class="token string">'Watcher only accepts simple dot-delimited paths. '</span> <span class="token operator">+</span>
          <span class="token string">'For full control, use a function instead.'</span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lazy
      <span class="token operator">?</span> <span class="token keyword">undefined</span>
      <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Evaluate the getter, and re-collect dependencies.
   */</span>
  <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pushTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> value
    <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">getter for watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> e
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token comment">// &quot;touch&quot; every property so they are all tracked as</span>
      <span class="token comment">// dependencies for deep watching</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>deep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">traverse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">popTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanupDeps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Add a dependency to this directive.
   */</span>
  <span class="token function">addDep</span> <span class="token punctuation">(</span><span class="token parameter">dep<span class="token punctuation">:</span> Dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Clean up for dependency collection.
   */</span>
  <span class="token function">cleanupDeps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>dep<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depIds
    <span class="token keyword">this</span><span class="token punctuation">.</span>depIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds <span class="token operator">=</span> tmp
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps
    <span class="token keyword">this</span><span class="token punctuation">.</span>deps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps <span class="token operator">=</span> tmp
    <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Subscriber interface.
   * Will be called when a dependency changes.
   */</span>
  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Scheduler job interface.
   * Will be called by the scheduler.
   */</span>
  <span class="token function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        value <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">||</span>
        <span class="token comment">// Deep watchers and watchers on Object/Arrays should fire even</span>
        <span class="token comment">// when the value is the same, because the value may</span>
        <span class="token comment">// have mutated.</span>
        <span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deep
      <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// set new value</span>
        <span class="token keyword">const</span> oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">callback for watcher &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Evaluate the value of the watcher.
   * This only gets called for lazy watchers.
   */</span>
  <span class="token function">evaluate</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Depend on all deps collected by this watcher.
   */</span>
  <span class="token function">depend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Remove self from all dependencies' subscriber list.
   */</span>
  <span class="token function">teardown</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// remove self from vm's watcher list</span>
      <span class="token comment">// this is a somewhat expensive operation so we skip it</span>
      <span class="token comment">// if the vm is being destroyed.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>_isBeingDestroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>_watchers<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span>length
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="è¿‡ç¨‹åˆ†æ"><a href="#è¿‡ç¨‹åˆ†æ" aria-hidden="true" class="header-anchor">#</a> è¿‡ç¨‹åˆ†æ</h4> <p><img src="/Notebook/assets/img/vue-reactive-collect-dep.66eb1980.png" alt=""></p> <p>ä¾èµ–æ”¶é›†è¿‡ç¨‹åˆ†æï¼š</p> <ul><li>ä¸€ä¸ªæ•°æ®å¦‚ data åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåœ¨ getter ä¸­æ–°å»ºä¸€ä¸ª <code>dep</code> ä¾èµ–ç±»ï¼Œé‡Œé¢æœ‰ subs ç”¨æ¥å­˜æ”¾ç®¡ç† <code>watcher</code>ã€‚</li> <li>å½“ render æ–¹æ³•è®¿é—®è¿™ä¸ªæ•°æ®æ—¶ï¼Œå®ƒçš„ getter è¢«è§¦å‘ï¼Œä¼šæ–°å»ºä¸€ä¸ª watcher è§‚å¯Ÿè€…ï¼Œç„¶å watcher ä½¿ç”¨å†…éƒ¨çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰å£°æ˜<code>dep</code>,æŠŠè‡ªå·±æ·»åŠ è¿›å» <code>dep</code> çš„ subs æˆ–è€…ä»ä¸­ç§»é™¤ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¾èµ–çš„æ”¶é›†ã€‚
è¿™æ ·ä¸‹æ¬¡ï¼Œè®¿é—® setter çš„ æ—¶å€™ï¼Œå°±å¯ä»¥æ´¾å‘æ›´æ–°äº†ã€‚</li></ul> <h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" aria-hidden="true" class="header-anchor">#</a> æ€»ç»“</h4> <p>é€šè¿‡è¿™ä¸€èŠ‚çš„åˆ†æï¼Œæˆ‘ä»¬å¯¹ Vue æ•°æ®çš„ä¾èµ–æ”¶é›†è¿‡ç¨‹å·²ç»æœ‰äº†è®¤è¯†ï¼Œå¹¶ä¸”å¯¹è¿™å…¶ä¸­çš„ä¸€äº›ç»†èŠ‚åšäº†åˆ†æã€‚æ”¶é›†ä¾èµ–çš„ç›®çš„æ—¶ä¸ºäº†å½“è¿™äº›å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘å®ƒä»¬çš„ setter çš„æ—¶å€™ï¼Œèƒ½çŸ¥é“åº”è¯¥é€šçŸ¥å“ªäº›è®¢é˜…è€…å»åšç›¸åº”çš„é€»è¾‘å¤„ç†ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹å«æ´¾å‘æ›´æ–°ã€‚</p> <h3 id="æ´¾å‘æ›´æ–°"><a href="#æ´¾å‘æ›´æ–°" aria-hidden="true" class="header-anchor">#</a> æ´¾å‘æ›´æ–°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Define a reactive property on an Object.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>
  <span class="token parameter">obj<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  val<span class="token punctuation">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token punctuation">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// cater for pre-defined getter/setters</span>
  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>get<span class="token punctuation">;</span>
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>set<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span> val<span class="token punctuation">;</span>
      <span class="token comment">/* eslint-disable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">/* eslint-enable no-self-compare */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Push a watcher into the watcher queue.
 * Jobs with duplicate IDs will be skipped unless it's
 * pushed when the queue is being flushed.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token parameter">watcher<span class="token punctuation">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// if already flushing, splice the watcher based on its id</span>
      <span class="token comment">// if already past its id, it will be run next immediately.</span>
      <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i<span class="token operator">--</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// queue the flush</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      waiting <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œå¼•å…¥äº†</p> <p><img src="/Notebook/assets/img/vue-reactive-dispatch-update.e8d53db2.png" alt=""></p> <h4 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" aria-hidden="true" class="header-anchor">#</a> æ€»ç»“</h4> <p>é€šè¿‡è¿™ä¸€èŠ‚çš„åˆ†æï¼Œæˆ‘ä»¬å¯¹ Vue æ•°æ®ä¿®æ”¹æ´¾å‘æ›´æ–°çš„è¿‡ç¨‹ä¹Ÿæœ‰äº†è®¤è¯†ï¼Œå®é™…ä¸Šå°±æ˜¯å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œè§¦å‘ setter é€»è¾‘ï¼ŒæŠŠåœ¨ä¾èµ–è¿‡ç¨‹ä¸­è®¢é˜…çš„æ‰€æœ‰è§‚å¯Ÿè€…ï¼Œä¹Ÿå°±æ˜¯ <code>watcher</code> ï¼Œéƒ½è§¦å‘å®ƒä»¬çš„ <code>update</code> è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹åˆåˆ©ç”¨äº†é˜Ÿåˆ—ï¼ˆwatcher é˜Ÿåˆ—ï¼‰åšäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œåœ¨ <code>nextTick</code> åæ‰§è¡Œæ‰€æœ‰ <code>watcher</code> çš„ <code>run</code>ï¼Œæœ€åæ‰§è¡Œå®ƒä»¬çš„å›è°ƒå‡½æ•°ã€‚</p> <h3 id="nexttick"><a href="#nexttick" aria-hidden="true" class="header-anchor">#</a> nextTick</h3> <h4 id="js-çš„è¿è¡Œæœºåˆ¶"><a href="#js-çš„è¿è¡Œæœºåˆ¶" aria-hidden="true" class="header-anchor">#</a> JS çš„è¿è¡Œæœºåˆ¶</h4> <p>JS æ˜¯å•çº¿ç¨‹çš„ï¼Œå®ƒæ˜¯åŸºäºäº‹ä»¶å¾ªç¯çš„ã€‚äº‹ä»¶å¾ªç¯å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p> <ol><li>æ‰€æœ‰åŒæ­¥ä»»åŠ¡éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ˆexecution context stackï¼‰ã€‚</li> <li>ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨â€œä»»åŠ¡é˜Ÿåˆ—â€ï¼ˆtask queueï¼‰ã€‚åªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æ„ï¼Œå°±åœ¨â€œä»»åŠ¡é˜Ÿåˆ—â€ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚</li> <li>ä¸€æ—¦â€œæ‰§è¡Œæ ˆâ€ä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–â€œä»»åŠ¡é˜Ÿåˆ—â€ï¼Œçœ‹çœ‹é‡Œé¢æœ‰å“ªäº›äº‹ä»¶ã€‚é‚£äº›å¯¹åº”çš„å¼‚æ­¥ä»»åŠ¡ï¼Œäºæ˜¯ç»“æŸç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ‰§è¡Œæ ˆï¼Œå¼€å§‹æ‰§è¡Œã€‚</li> <li>ä¸»çº¿ç¨‹ä¸æ–­é‡å¤ä¸Šé¢çš„ç¬¬ä¸‰æ­¥ã€‚</li></ol> <p>ä¸»çº¿ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹å°±æ˜¯ä¸€ä¸ª tickï¼Œè€Œæ‰€æœ‰çš„å¼‚æ­¥ç»“æœéƒ½æ˜¯é€šè¿‡â€œä»»åŠ¡é˜Ÿåˆ—â€æ¥è°ƒåº¦ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªä¸ªçš„ä»»åŠ¡ï¼ˆtaskï¼‰ã€‚è§„èŒƒä¸­è§„å®šâ€œtaskâ€åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ macor å’Œ microtaskï¼Œå¹¶ä¸”æ¯ä¸ª macrotask ç»“æŸåï¼Œéƒ½è¦æ¸…ç©ºæ‰€æœ‰ microtaskã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>macroTask <span class="token keyword">of</span> macroTaskQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Handle current MACRO-TASK</span>
  <span class="token function">handleMacroTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. Handle all MICRO-TASK</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>microTask <span class="token keyword">of</span> microTaskQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleMicroTask</span><span class="token punctuation">(</span>microTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå¸¸è§çš„ macro task æœ‰ setTimeoutã€MessageChannelã€postMessageã€setImmediateï¼›
å¸¸è§çš„ micro task æœ‰ MutationObserver å’Œ Promise.thenã€‚</p> <h4 id="vue-çš„å®ç°"><a href="#vue-çš„å®ç°" aria-hidden="true" class="header-anchor">#</a> Vue çš„å®ç°</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* @flow */</span>
<span class="token comment">/* globals MessageChannel */</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> noop <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'shared/util'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> handleError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./error'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> isIOS<span class="token punctuation">,</span> isNative <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./env'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">flushCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Here we have async deferring wrappers using both microtasks and (macro) tasks.</span>
<span class="token comment">// In &lt; 2.4 we used microtasks everywhere, but there are some scenarios where</span>
<span class="token comment">// microtasks have too high a priority and fire in between supposedly</span>
<span class="token comment">// sequential events (e.g. #4521, #6690) or even between bubbling of the same</span>
<span class="token comment">// event (#6566). However, using (macro) tasks everywhere also has subtle problems</span>
<span class="token comment">// when state is changed right before repaint (e.g. #6813, out-in transitions).</span>
<span class="token comment">// Here we use microtask by default, but expose a way to force (macro) task when</span>
<span class="token comment">// needed (e.g. in event handlers attached by v-on).</span>
<span class="token keyword">let</span> microTimerFunc<span class="token punctuation">;</span>
<span class="token keyword">let</span> macroTimerFunc<span class="token punctuation">;</span>
<span class="token keyword">let</span> useMacroTask <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// Determine (macro) task defer implementation.</span>
<span class="token comment">// Technically setImmediate should be the ideal choice, but it's only available</span>
<span class="token comment">// in IE. The only polyfill that consistently queues the callback after all DOM</span>
<span class="token comment">// events triggered in the same loop is by using MessageChannel.</span>
<span class="token comment">/* istanbul ignore if */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token keyword">typeof</span> MessageChannel <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span><span class="token function">isNative</span><span class="token punctuation">(</span>MessageChannel<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token comment">// PhantomJS</span>
    MessageChannel<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object MessageChannelConstructor]'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> channel<span class="token punctuation">.</span>port2<span class="token punctuation">;</span>
  channel<span class="token punctuation">.</span>port1<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> flushCallbacks<span class="token punctuation">;</span>
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">/* istanbul ignore next */</span>
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Determine microtask defer implementation.</span>
<span class="token comment">/* istanbul ignore next, $flow-disable-line */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function-variable function">microTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// in problematic UIWebViews, Promise.then doesn't completely break, but</span>
    <span class="token comment">// it can get stuck in a weird state where callbacks are pushed into the</span>
    <span class="token comment">// microtask queue but the queue isn't being flushed, until the browser</span>
    <span class="token comment">// needs to do some other work, e.g. handle a timer. Therefore we can</span>
    <span class="token comment">// &quot;force&quot; the microtask queue to be flushed by adding an empty timer.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// fallback to macro</span>
  microTimerFunc <span class="token operator">=</span> macroTimerFunc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Wrap a function so that if any code inside triggers state change,
 * the changes are queued using a (macro) task instead of a microtask.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">withMacroTask</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">:</span> Function</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Function <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    fn<span class="token punctuation">.</span>_withTask <span class="token operator">||</span>
    <span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function-variable function">_withTask</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      useMacroTask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      useMacroTask <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token punctuation">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token punctuation">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _resolve<span class="token punctuation">;</span>
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>useMacroTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">macroTimerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">microTimerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// $flow-disable-line</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      _resolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>next-tick.js</code> å£°æ˜äº† <code>microTimerFunc</code> å’Œ <code>macroTimerFunc</code> 2 ä¸ªå˜é‡ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”çš„æ˜¯ microTask çš„å‡½æ•°å’Œ macro task çš„å‡½æ•°ã€‚å¯¹äº macro task çš„å®ç°ï¼Œä¼˜å…ˆç›‘æµ‹æ˜¯å¦æ”¯æŒåŸç”Ÿçš„ <code>setImmediate</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜ç‰ˆæœ¬ IE å’Œ Edge æ‰æ”¯æŒçš„ç‰¹æ€§ã€‚ä¸æ”¯æŒçš„è¯å†å»æ£€æµ‹æ˜¯å¦æ”¯æŒåŸç”Ÿçš„ <code>MessageChannel</code>ï¼Œå¦‚æœä¹Ÿä¸æ”¯æŒçš„è¯å°±ä¼šé™çº§ä¸º s<code>etTimeout 0</code>ï¼›è€Œå¯¹äº micro task çš„å®ç°ï¼Œåˆ™æ£€æµ‹æµè§ˆå™¨æ˜¯å¦åŸç”Ÿæ”¯æŒ <code>Promise</code>ï¼Œä¸æ”¯æŒçš„è¯ç›´æ¥æŒ‡å‘ macro task çš„å®ç°ã€‚</p> <p><code>next-tick.js</code> å¯¹å¤–æš´éœ²äº† 2 ä¸ªå‡½æ•°ï¼Œå…ˆæ¥çœ‹ <code>nextTick</code> ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚æ‰§è¡Œ <code>nextTick(flushSchedulerQueue)</code> æ‰€ç”¨åˆ°çš„å‡½æ•°ã€‚å®ƒçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p> <ol><li>æŠŠ ä¼ å…¥çš„å›è°ƒå‡½æ•° <code>cb</code> å‹å…¥ <code>callbacks</code> æ•°ç»„ï¼›</li> <li>æœ€åä¸€æ¬¡æ€§æ ¹æ®<code>useMacroTask</code> æ¡ä»¶æ‰§è¡Œ <code>macroTimerFunc</code> æˆ–è€…æ˜¯ <code>microTimerFunc</code> ï¼Œè€Œå®ƒä»¬éƒ½ä¼šåœ¨ä¸‹ä¸€ä¸ª <code>tick</code> æ‰§è¡Œ <code>flushCallbacks</code></li> <li><code>flushCallbacks</code> å¯¹ <code>callbacks</code> éå†ï¼Œç„¶åæ‰§è¡Œå“åº”çš„å›è°ƒå‡½æ•°ã€‚</li></ol> <h4 id="ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ-mictrotask-çš„å¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œ-macrotask-çš„å¤„ç†ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ-mictrotask-çš„å¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œ-macrotask-çš„å¤„ç†ï¼Ÿ" aria-hidden="true" class="header-anchor">#</a> ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ mictroTask çš„å¤„ç†ï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œ macroTask çš„å¤„ç†ï¼Ÿ</h4> <p>é€šè¿‡ <code>next-tick.js</code> å¯¹å¤–æš´éœ²äº† <code>withMacroTask</code> å‡½æ•°ï¼Œå®ƒæ˜¯å¯¹å‡½æ•°åšä¸€å±‚åŒ…è£…ï¼Œç¡®ä¿å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹æ•°æ®ä»»æ„çš„ä¿®æ”¹ï¼Œè§¦å‘å˜åŒ–æ‰§è¡Œ <code>nextTick</code> çš„æ—¶å€™å¼ºåˆ¶èµ° <code>macroTimerFunc</code>ã€‚æ¯”å¦‚å¯¹äºä¸€äº› DOM äº¤äº’äº‹ä»¶ï¼Œå¦‚ <code>v-on</code> ç»‘å®šçš„äº‹ä»¶å›è°ƒå‡½æ•°çš„å¤„ç†ï¼Œä¼šå¼ºåˆ¶èµ° macro taskã€‚</p> <p>ä¸‹é¢æ˜¯ <code>event.js</code> æ³¨å†Œäº‹ä»¶æ—¶ï¼Œå¼•ç”¨äº† <code>withMacroTask</code> å‡½æ•°ã€‚<code>plaform/web/runtime/modules/event.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>

<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span>
  <span class="token parameter">event<span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  handler<span class="token punctuation">:</span> Function<span class="token punctuation">,</span>
  once<span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>
  capture<span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>
  passive<span class="token punctuation">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  handler <span class="token operator">=</span> <span class="token function">withMacroTask</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>once<span class="token punctuation">)</span> handler <span class="token operator">=</span> <span class="token function">createOnceHandler</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> event<span class="token punctuation">,</span> capture<span class="token punctuation">)</span>
  target<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
    event<span class="token punctuation">,</span>
    handler<span class="token punctuation">,</span>
    supportsPassive
      <span class="token operator">?</span> <span class="token punctuation">{</span> capture<span class="token punctuation">,</span> passive <span class="token punctuation">}</span>
      <span class="token punctuation">:</span> capture
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><h4 id="nexttick-ä¸ºä»€ä¹ˆè¦-microtask-ä¼˜å…ˆï¼Ÿ"><a href="#nexttick-ä¸ºä»€ä¹ˆè¦-microtask-ä¼˜å…ˆï¼Ÿ" aria-hidden="true" class="header-anchor">#</a> nextTick ä¸ºä»€ä¹ˆè¦ microtask ä¼˜å…ˆï¼Ÿ</h4> <p>åŠ¨ç”»æ€§èƒ½</p> <h3 id="vue-çš„-diff-ç®—æ³•"><a href="#vue-çš„-diff-ç®—æ³•" aria-hidden="true" class="header-anchor">#</a> vue çš„ diff ç®—æ³•</h3> <h4 id="è™šæ‹Ÿ-dom"><a href="#è™šæ‹Ÿ-dom" aria-hidden="true" class="header-anchor">#</a> è™šæ‹Ÿ dom</h4> <p>æ‰€è°“çš„ <code>vitural dom</code>ï¼Œä¹Ÿå°±æ˜¯è™šæ‹ŸèŠ‚ç‚¹ã€‚å®ƒé€šè¿‡ JS çš„ Object å¯¹è±¡æ¨¡æ‹Ÿ DOM ä¸­çš„èŠ‚ç‚¹ï¼Œç„¶åå†é€šè¿‡ç‰¹å®šçš„ <code>render</code> æ–¹æ³•å°†å…¶æ¸²æŸ“æˆçœŸå®çš„ DOM èŠ‚ç‚¹ã€‚<code>dom diff</code> æ˜¯ é€šè¿‡ JS å±‚é¢çš„è®¡ç®—ï¼Œè¿”å›ä¸€ä¸ª <code>patch</code> å¯¹è±¡ï¼Œå³è¡¥ä¸å¯¹è±¡ï¼Œå†é€šè¿‡ç‰¹å®šçš„æ“ä½œè§£æ <code>patch</code> å¯¹è±¡ï¼Œå®Œæˆé¡µé¢çš„é‡æ–°æ¸²æŸ“ã€‚</p> <p><img src="/Notebook/assets/img/dom-diff.3328ffee.png" alt=""></p> <ul><li>å®ç°æ­¥éª¤
<ul><li>ç”¨ JavaScript å¯¹è±¡æ¨¡æ‹Ÿ DOM</li> <li>æŠŠæ­¤è™šæ‹Ÿ DOM è½¬æˆçœŸå® DOM å¹¶æ’å…¥é¡µé¢ä¸­</li> <li>å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿä¿®æ”¹äº†è™šæ‹Ÿ DOM</li> <li>æ¯”è¾ƒä¸¤æ£µè™šæ‹Ÿ DOM æ ‘çš„å·®å¼‚ï¼Œå¾—åˆ°å·®å¼‚å¯¹è±¡</li> <li>æŠŠå·®å¼‚å¯¹è±¡åº”ç”¨åˆ°çœŸæ­£çš„ DOM æ ‘ä¸Šã€‚</li></ul></li></ul> <h3 id="vue-ç»„ä»¶é‡ç½®çŠ¶æ€ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰"><a href="#vue-ç»„ä»¶é‡ç½®çŠ¶æ€ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰" aria-hidden="true" class="header-anchor">#</a> vue ç»„ä»¶é‡ç½®çŠ¶æ€ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰</h3> <h4 id="çˆ¶å­ç»„ä»¶ï¼Œå¯ä»¥è®¿é—®ç»„ä»¶çš„æƒ…å†µä¸‹"><a href="#çˆ¶å­ç»„ä»¶ï¼Œå¯ä»¥è®¿é—®ç»„ä»¶çš„æƒ…å†µä¸‹" aria-hidden="true" class="header-anchor">#</a> çˆ¶å­ç»„ä»¶ï¼Œå¯ä»¥è®¿é—®ç»„ä»¶çš„æƒ…å†µä¸‹</h4> <ul><li>å­ç»„ä»¶å¯¹å¤–æä¾›é‡ç½®æ–¹æ³•æˆ– Prop</li> <li>V-if å¼ºåˆ¶åˆ·æ–°</li> <li>key å¼ºåˆ¶åˆ·æ–°ï¼ˆ<code>key: this.id = +new Date()</code>ï¼‰</li></ul> <p>é€šè¿‡ key,v-if æ•´ä½“åˆ·æ–°ç”¨æˆ·ä½“éªŒä¸å¤ªå‹å¥½ã€‚</p> <h4 id="è·¨çº§ç»„ä»¶"><a href="#è·¨çº§ç»„ä»¶" aria-hidden="true" class="header-anchor">#</a> è·¨çº§ç»„ä»¶</h4> <p>å¦‚å®ç°äº’æ–¥å…³ç³»ï¼ˆeventBus å¤ªå¤šä¹Ÿä¹±ï¼‰</p> <h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" aria-hidden="true" class="header-anchor">#</a> å¸¸è§é—®é¢˜</h2> <h3 id="å­˜å‚¨è·¯ç”±å‚æ•°ï¼Œè§£å†³å­˜å‚¨-params-çš„åˆ·æ–°ä¸¢å¤±é—®é¢˜"><a href="#å­˜å‚¨è·¯ç”±å‚æ•°ï¼Œè§£å†³å­˜å‚¨-params-çš„åˆ·æ–°ä¸¢å¤±é—®é¢˜" aria-hidden="true" class="header-anchor">#</a> å­˜å‚¨è·¯ç”±å‚æ•°ï¼Œè§£å†³å­˜å‚¨ params çš„åˆ·æ–°ä¸¢å¤±é—®é¢˜</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å­˜å‚¨è·¯ç”±å‚æ•°æ•°æ®</span>
localStorage<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token constant">PRODUCTROUTERPARAMS</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  resultCatalog
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vue-å®ä¾‹åˆå§‹åŒ–"><a href="#vue-å®ä¾‹åˆå§‹åŒ–" aria-hidden="true" class="header-anchor">#</a> Vue å®ä¾‹åˆå§‹åŒ–</h3> <ul><li>å¦‚æœ <code>props</code> ä¾èµ–çš„å€¼æ˜¯å¼‚æ­¥ä¼ é€’çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™åœ¨ <code>created()</code> é‡Œèƒ½å¦æ‹¿åˆ°è¿™ä¸ªå€¼?</li> <li>ä¸šåŠ¡ç»„ä»¶ä¸åŸºç¡€ç»„ä»¶çš„ <code>props</code> åŒºåˆ«</li></ul> <h3 id="æƒé™è·¯ç”±"><a href="#æƒé™è·¯ç”±" aria-hidden="true" class="header-anchor">#</a> æƒé™è·¯ç”±</h3> <p>æµç¨‹ï¼š</p> <ol><li>è·å–æƒé™è·¯ç”±ï¼ˆè¿›è¡Œæ‰å¹³åŒ–æ ¼å¼åŒ–ï¼‰â¡ è·å¾—æ ¼å¼åŒ–çš„è·¯ç”± permissionMap</li> <li>è·å¾—æœ¬åœ°è®¾ç½®çš„è·¯ç”±ï¼Œé€’å½’éå†è·¯ç”±æ¯ä¸ª routeï¼Œåœ¨ permissionMap å¯»æ‰¾æ˜¯å¦å­˜åœ¨ routeï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›è¯¥ permissionInfo çš„ä¿¡æ¯ã€‚</li> <li>è·å¾—åˆå¹¶åçš„è·¯ç”± accessRoutes ï¼Œç„¶ååœ¨è·¯ç”±æ‹¦æˆªé‡ŒåŠ¨æ€æ·»åŠ è·¯ç”±</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** *
 * @description æ ¼å¼åŒ–æƒé™ä¿¡æ¯ï¼Œå°†arrayè½¬ä¸ºhash
 * @param {Array} permission [æƒé™ä¿¡æ¯]
 * @param {Object} permissionMap [è½¬æ¢åæƒé™å¯¹è±¡]
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">formatPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">permission<span class="token punctuation">,</span> permissionMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    permission<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> name<span class="token punctuation">,</span> type<span class="token punctuation">,</span> meta<span class="token punctuation">,</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'route'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> permissionInfo <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>meta<span class="token punctuation">,</span> title<span class="token punctuation">,</span> code<span class="token punctuation">,</span> index <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> rotueKey <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        permissionMap<span class="token punctuation">[</span>rotueKey<span class="token punctuation">]</span> <span class="token operator">=</span> permissionInfo<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> route<span class="token punctuation">,</span> component<span class="token punctuation">,</span> operation <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">separateChildren</span><span class="token punctuation">(</span>
            item<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
            code
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          permissionInfo<span class="token punctuation">.</span>components <span class="token operator">=</span> component<span class="token punctuation">;</span>
          permissionInfo<span class="token punctuation">.</span>operations <span class="token operator">=</span> operation<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>route <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            route<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routeItem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              routeItem<span class="token punctuation">.</span>code <span class="token operator">=</span> routeItem<span class="token punctuation">.</span>code <span class="token operator">||</span> code<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">formatPermission</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> permissionMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> permissionMap<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description æ ¹æ®æƒé™å¯¹è±¡æ¥åˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®å½“å‰è·¯ç”±
 * @param {Object} routeInfo [è·¯ç”±ä¿¡æ¯]
 * @param {Object} permissionMap [æƒé™å¯¹è±¡]
 * @returns {Object} permissionInfo [æƒé™ä¿¡æ¯]
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">hasPermission</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">routeInfo<span class="token punctuation">,</span> permissionMap</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> permissionInfo <span class="token operator">=</span> permissionMap<span class="token punctuation">[</span><span class="token function">String</span><span class="token punctuation">(</span>routeInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> permissionInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description è·å–æœ‰æƒé™è®¿é—®çš„è·¯ç”±
 * @param {Array} asyncRoutes [æœ¬åœ°åŠ¨æ€è·¯ç”±]
 * @param {Array} permission [åå°è¿”å›å¸¦è·¯ç”±ä¿¡æ¯çš„åŠŸèƒ½ç»“æ„åˆ—è¡¨]
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">generateAsyncRoutes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">asyncRoutes<span class="token punctuation">,</span> permission</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> permissionMap <span class="token operator">=</span> <span class="token function">formatPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token function">filterAsyncRoutesByPermissionMap</span><span class="token punctuation">(</span>asyncRoutes<span class="token punctuation">,</span> permissionMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @description: æ ¹æ®è¿ç»´è·¯ç”±æƒé™ï¼Œè¿‡æ»¤æœ¬åœ°è·¯ç”±æ–‡ä»¶
 * @param {Array} asyncRoutes æœ¬åœ°è®¾ç½®çš„è·¯ç”±
 * @param {Object} permissionMap æ‰å¹³åŒ–çš„æƒé™è·¯ç”±è§„åˆ™å¯¹è±¡
 * @return: array è¿‡æ»¤åçš„æœ¬åœ°è·¯ç”±æ–‡ä»¶
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">filterAsyncRoutesByPermissionMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">asyncRoutes<span class="token punctuation">,</span> permissionMap</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  asyncRoutes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// if (route.path === &quot;*&quot;) {</span>
    <span class="token comment">//   res.push(tmp)</span>
    <span class="token comment">// }</span>
    <span class="token keyword">const</span> tmp <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>route <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> permissionInfo <span class="token operator">=</span> <span class="token function">hasPermission</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> permissionMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>permissionInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tmp<span class="token punctuation">.</span>meta <span class="token operator">=</span> tmp<span class="token punctuation">.</span>meta <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> filteredPermissionInfo <span class="token operator">=</span> <span class="token function">filterObject</span><span class="token punctuation">(</span>permissionInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  åˆ é™¤å¯¹è±¡ä¸ºç©ºçš„å±æ€§</span>
      tmp<span class="token punctuation">.</span>meta <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>meta<span class="token punctuation">,</span> filteredPermissionInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆå¹¶å¯¹è±¡</span>
      tmp<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>navTitle <span class="token operator">=</span> tmp<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token punctuation">;</span> <span class="token comment">// route.metaæ··å…¥æƒé™ä¿¡æ¯</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tmp<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">filterAsyncRoutesByPermissionMap</span><span class="token punctuation">(</span>
          tmp<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
          permissionMap
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// æŒ‰è¿ç»´é…ç½®é¡ºåºå¯¹è·¯ç”±è¿›è¡Œæ’åº</span>
      res<span class="token punctuation">[</span>tmp<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="å½“å‡ºç°é‡å®šå‘çš„é—®é¢˜æ—¶å¦‚ä½•è§£å†³-404-çš„é—®é¢˜"><a href="#å½“å‡ºç°é‡å®šå‘çš„é—®é¢˜æ—¶å¦‚ä½•è§£å†³-404-çš„é—®é¢˜" aria-hidden="true" class="header-anchor">#</a> å½“å‡ºç°é‡å®šå‘çš„é—®é¢˜æ—¶å¦‚ä½•è§£å†³ 404 çš„é—®é¢˜</h4> <p>è¿ç»´æŠŠä¸€çº§ç³»ç»Ÿçš„å­ç³»ç»Ÿè·¯ç”±åˆ æ‰äº†ï¼Œä½†æ˜¯ä¸€çº§ç³»ç»Ÿè®¾ç½®äº† redirect å±æ€§å€¼ä¸ºå­ç³»ç»Ÿè·¯ç”±ï¼Œè¿™ç§æƒ…å†µå¦‚ä½•å¤„ç†ï¼Ÿ
æ–¹æ¡ˆä¸€ï¼šé¦–å…ˆåˆ¤æ–­<code>tmp.redirect</code>æ˜¯å¦å­˜åœ¨ï¼Œè¯¥ä¸€çº§ç³»ç»Ÿçš„è¿™ä¸ªé‡å®šå‘å­ç³»ç»Ÿæ˜¯å¦å­˜åœ¨ï¼ˆè·¯ç”±ä¿¡æ¯ï¼‰ï¼Œä¸å­˜åœ¨çš„è¯ï¼Œé¡ºä½ç›´æ¥å¯»æ‰¾ä¸‹ä¸€ä¸ªï¼Œç„¶åè®¾ç½® <code>tmp.redirect= { name: firstChildName }</code>
éƒ½ä¸å­˜åœ¨çš„è¯ï¼Œåˆ™æŠŠè¿™ä¸ªåˆ é™¤é‡å®šå‘çš„å±æ€§<code>delete tmp.redirect</code>ã€‚</p> <p>åŸåˆ™æ˜¯ï¼šéœ€è¦æŠŠè¦é‡å®šå‘çš„ç³»ç»Ÿè·¯ç”±æ”¾åˆ°ç¬¬ä¸€ä½ã€‚é’ˆå¯¹è¿™ä¸ªç—›ç‚¹ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯å…ˆåˆ¤æ–­å¯¹åº”çš„ redirect çš„è·¯ç”±æƒé™æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å†èµ°ä¸‹é¢çš„é€»è¾‘ã€‚
æ³¨æ„è¦å¤„ç†ï¼šredirect çš„ä¸¤ç§æƒ…å†µï¼Œå®ƒæœ‰å¯èƒ½æ˜¯å­—ç¬¦ä¸² path å½¢å¼ï¼Œä¹Ÿå¯èƒ½æ˜¯å¯¹è±¡ <code>{name: 'xxx'}</code> å½¢å¼ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">filterAsyncRoutesByPermissionMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">asyncRoutes<span class="token punctuation">,</span> permissionMap</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  asyncRoutes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tmp <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>route <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> permissionInfo <span class="token operator">=</span> <span class="token function">hasPermission</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> permissionMap<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>permissionInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tmp<span class="token punctuation">.</span>meta <span class="token operator">=</span> tmp<span class="token punctuation">.</span>meta <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> filteredPermissionInfo <span class="token operator">=</span> <span class="token function">filterObject</span><span class="token punctuation">(</span>permissionInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      tmp<span class="token punctuation">.</span>meta <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>meta<span class="token punctuation">,</span> filteredPermissionInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      tmp<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>navTitle <span class="token operator">=</span> tmp<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title<span class="token punctuation">;</span> <span class="token comment">// route.metaæ··å…¥æƒé™ä¿¡æ¯</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å½“æœ‰é‡å®šå‘çš„å­—æ®µredirectæ—¶</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> tmp<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'redirect'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> routeInfo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tmp<span class="token punctuation">.</span>redirect <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            routeInfo <span class="token operator">=</span> tmp<span class="token punctuation">.</span>redirect<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tmp<span class="token punctuation">.</span>redirect <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> strArr <span class="token operator">=</span> tmp<span class="token punctuation">.</span>redirect<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            routeInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
              name<span class="token punctuation">:</span> strArr<span class="token punctuation">[</span>strArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æœ¬åœ°è·¯ç”±redirectå­—æ®µå€¼è®¾ç½®é”™è¯¯'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">const</span> isHasRedirectPermisson <span class="token operator">=</span> <span class="token function">hasPermission</span><span class="token punctuation">(</span>
            routeInfo<span class="token punctuation">,</span>
            permissionMap
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// æœ¬åœ°è®¾ç½®çš„é‡å®šå‘è·¯ç”±ä¸å­˜åœ¨è¿ç»´é‡Œæƒé™è·¯ç”±</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isHasRedirectPermisson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å–å‡ºè¯¥è·¯ç”±èŠ‚ç‚¹ä¸‹ç¬¬ä¸€ä¸ªæœ‰æƒé™çš„å­èŠ‚ç‚¹</span>
            <span class="token keyword">let</span> firstChildrenHasPermission <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tmp<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> childRouter <span class="token operator">=</span> tmp<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">const</span> childPermissionInfo <span class="token operator">=</span> <span class="token function">hasPermission</span><span class="token punctuation">(</span>
                childRouter<span class="token punctuation">,</span>
                permissionMap
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>childPermissionInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                firstChildrenHasPermission <span class="token operator">=</span> childPermissionInfo<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>firstChildrenHasPermission<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              tmp<span class="token punctuation">.</span>redirect <span class="token operator">=</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> firstChildrenHasPermission<span class="token punctuation">.</span>name
              <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// æ²¡æœ‰æƒé™ï¼Œåˆ é™¤é‡å®šå‘å­—æ®µ</span>
              <span class="token keyword">delete</span> tmp<span class="token punctuation">.</span>redirect<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        tmp<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">filterAsyncRoutesByPermissionMap</span><span class="token punctuation">(</span>
          tmp<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
          permissionMap
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// æŒ‰è¿ç»´é…ç½®é¡ºåºå¯¹è·¯ç”±è¿›è¡Œæ’åº</span>
      res<span class="token punctuation">[</span>tmp<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="query-ä¸-params-çš„åŒºåˆ«ä¸ä½¿ç”¨"><a href="#query-ä¸-params-çš„åŒºåˆ«ä¸ä½¿ç”¨" aria-hidden="true" class="header-anchor">#</a> query ä¸ params çš„åŒºåˆ«ä¸ä½¿ç”¨</h4> <h3 id="è®°å½•ç”¨æˆ·çš„å†å²é¡µé¢"><a href="#è®°å½•ç”¨æˆ·çš„å†å²é¡µé¢" aria-hidden="true" class="header-anchor">#</a> è®°å½•ç”¨æˆ·çš„å†å²é¡µé¢</h3> <p>éœ€æ±‚ï¼š</p> <ul><li>åœ¨è®¿é—®è¿‡ç¨‹ä¸­ session è¿‡æœŸäº†ï¼Œæˆ‘ç‚¹æŸä¸ªåŠŸèƒ½çš„æ—¶å€™ä¼šè·³åˆ°ç™»å½•é¡µï¼Œè¿™ä¸ªæ—¶å€™æˆ‘è‚¯å®šæ˜¯æƒ³ï¼Œæˆ‘å®Œæˆç™»å½•åè¿˜æ˜¯å›åˆ°æˆ‘ä¹‹å‰çš„é¡µé¢</li> <li>ä¸€ç§åœºæ™¯æ˜¯æœ‰äººåˆ†äº«ç»™ä½ ä¸€ä¸ªç³»ç»Ÿé“¾æ¥ è®©ä½ çœ‹æŸä¸ªæ¨¡å—çš„å†…å®¹ï¼Œä½†æ˜¯æ­¤æ—¶ä½ ä¸æ˜¯ç™»å½•çŠ¶æ€ é‚£ç™»å½•ä¹‹åè¿›çš„è¿˜æ˜¯ portal é¡µé¢ï¼Œå¹¶ä¸æ˜¯ä»–æƒ³è®©ä½ çœ‹åˆ°çš„é‚£ä¸ªé¡µé¢</li></ul> <p>ç³»ç»Ÿæœ‰ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯å¦‚æœè·å–ç”¨æˆ·æƒé™è¡¨å¤±è´¥çš„æ—¶å€™ï¼Œä¼šè·³å›åˆ°ç™»å½•é¡µï¼Œè·³å›ä¹‹å‰ä¼šæŠŠç”¨æˆ·è¦è¿›å…¥çš„è·¯ç”±è®°å½•åˆ° cookieï¼Œç„¶åä¸‹æ¬¡ç™»å½•é‡å®šå‘åˆ°æ­¤è·¯ç”±é¡µé¢ï¼Œxxx æœ‰å‡ ä¸ªé¡µé¢æ˜¯æºå¸¦è·¯ç”±å‚æ•°çš„ï¼Œæˆ‘ä»¬å‘ç°ä¿®å¤ä¹‹å‰ cookie ä¸Šè®°å½•çš„æ˜¯æ²¡å¸¦å‚æ•°çš„ï¼Œæ‰€ä»¥é‡å®šå‘æ¸²æŸ“é¡µé¢å°±ä¼šæŠ¥é”™ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯è¦æŠŠå‚æ•°å†™å…¥åˆ° cookie é‡Œï¼Œæœ¬æ¥æ‰“ç®—å»æŠŠè·¯ç”±çš„ query å¯¹è±¡æ ¼å¼åŒ–å­˜åˆ° cookie é‡Œï¼Œåæ¥çœ‹äº†ä¸‹æ–‡æ¡£ï¼Œå‘ç°æœ‰ä¸ª<code>fullPath</code>å€¼å¯ä»¥è§£å†³
è¿™æ ·å°±ä¸ç”¨å†™å¯¹è±¡æ ¼å¼åŒ–å‚æ•°çš„é€»è¾‘æˆ–è€…ç”¨<code>qs</code>åº“ï¼Œvue-router ç¡®å®å¾ˆè´´å¿ƒäº†ã€‚</p> <h3 id="åŒå‘ç»‘å®š"><a href="#åŒå‘ç»‘å®š" aria-hidden="true" class="header-anchor">#</a> åŒå‘ç»‘å®š</h3> <ul><li>v-model
çˆ¶å¯ä»¥æ”¹å˜å­ï¼ˆæ•°æ®ï¼‰ï¼Œ ä½†å­ä¸èƒ½ç›´æ¥æ”¹å˜çˆ¶ï¼ˆæ•°æ®ï¼‰ï¼ï¼Œ çˆ¶ä¸­æ•°æ®çš„å˜åŠ¨åªèƒ½ç”±å®ƒè‡ªå·±å†³å®š</li> <li>å¯¹è±¡ï¼ˆé€‰æ‹©ä¸‹æ‹‰æ ‘ï¼‰ï¼Œä½†æ˜¯æ”¹å˜ä¸å¤Ÿç›´è§‚ã€‚</li> <li><code>.sync</code> (props + emit: update)ï¼Œç›´è§‚æ˜äº†ï¼Œæ³¨æ„çš„æ˜¯å¦‚æœä¼ é€’å¯¹è±¡çš„è¯ï¼Œå­ç»„ä»¶ä¸è¦ç›´æ¥å¼•ç”¨<code>prop</code>ï¼Œè¦åšå¥½æ·±æ‹·è´ã€‚
ä¸ v-model çš„åŒºåˆ«å°±æ˜¯çˆ¶å­ç»„ä»¶çš„åœ°ä½æ˜¯å¹³ç­‰çš„ã€‚ çˆ¶å¯ä»¥æ”¹å˜å­ï¼ˆæ•°æ®ï¼‰ï¼Œ å­ä¹Ÿå¯ä»¥æ”¹å˜çˆ¶ï¼ˆæ•°æ®ï¼‰ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/// parent.vue</span>
<span class="token operator">&lt;</span>DropStatusList <span class="token punctuation">:</span>currentSelectedTask<span class="token punctuation">.</span>sync<span class="token operator">=</span><span class="token string">&quot;currentSelectedTask&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>DropStatusList<span class="token operator">&gt;</span>

<span class="token comment">// child.vue</span>
props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  currentSelectedTask<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
    <span class="token function-variable function">default</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// ä¸‹æ‹‰ç‚¹å‡»äº‹ä»¶</span>
<span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listData<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">.</span>label <span class="token operator">===</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:currentSelectedTask&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" aria-hidden="true" class="header-anchor">#</a> å‚è€ƒèµ„æ–™</h2> <ul><li><a href="https://juejin.im/post/5d267dcdf265da1b957081a3" target="_blank" rel="noopener noreferrer">vue ä¸­ 8 ç§ç»„ä»¶é€šä¿¡æ–¹å¼, å€¼å¾—æ”¶è—!<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/pablohpsilva/vuejs-component-style-guide/blob/master/README-CN.md" target="_blank" rel="noopener noreferrer">Vue.js ç»„ä»¶ç¼–ç è§„èŒƒ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5c49cff56fb9a049bd42a90f#heading-4" target="_blank" rel="noopener noreferrer">å‰ç«¯ç»„ä»¶è®¾è®¡åŸåˆ™<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5bb355dae51d450ea4020b42" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5bb355dae51d450ea4020b42<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/aooy/blog/issues/5" target="_blank" rel="noopener noreferrer">ä» event loop è§„èŒƒæ¢ç©¶ javaScript å¼‚æ­¥åŠæµè§ˆå™¨æ›´æ–°æ¸²æŸ“æ—¶æœº<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5a69ece0f265da3e5a5777ed#heading-2" target="_blank" rel="noopener noreferrer">æ·±å…¥ç†è§£ vue ä¸­çš„ slot ä¸ slot-scope<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5ad6182df265da23906c8627#heading-1" target="_blank" rel="noopener noreferrer">é¢è¯•å®˜ï¼šä½ äº†è§£ vue çš„ diff ç®—æ³•å—ï¼Ÿ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- ä»è™šæ‹Ÿ DOM åˆ° diff ä»£ç çš„åŸºæœ¬å®ç°ï¼Œå¯ä»¥å¤§æ¦‚çœ‹çœ‹å®ç°ã€‚</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">4/16/2021, 5:39:03 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/Notebook/frontend-web/react.html" class="prev">
          React
        </a></span> <span class="next"><a href="/Notebook/frontend-web/webpack.html">
          webpack
        </a>
        â†’
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Notebook/assets/js/app.fae3116e.js" defer></script><script src="/Notebook/assets/js/3.8a90166b.js" defer></script><script src="/Notebook/assets/js/12.295d52cd.js" defer></script>
  </body>
</html>
