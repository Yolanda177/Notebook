<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS | Yolanda</title>
    <meta name="description" content="每天学习一点点">
    <link rel="icon" href="/Notebook/images/mylogo.jpg">
    
    <link rel="preload" href="/Notebook/assets/css/0.styles.4f932b82.css" as="style"><link rel="preload" href="/Notebook/assets/js/app.fae3116e.js" as="script"><link rel="preload" href="/Notebook/assets/js/3.8a90166b.js" as="script"><link rel="preload" href="/Notebook/assets/js/7.a97cfeeb.js" as="script"><link rel="prefetch" href="/Notebook/assets/js/10.7c0500f6.js"><link rel="prefetch" href="/Notebook/assets/js/11.96ce6645.js"><link rel="prefetch" href="/Notebook/assets/js/12.295d52cd.js"><link rel="prefetch" href="/Notebook/assets/js/13.6db71019.js"><link rel="prefetch" href="/Notebook/assets/js/14.0c1400d8.js"><link rel="prefetch" href="/Notebook/assets/js/15.edab26a3.js"><link rel="prefetch" href="/Notebook/assets/js/16.88fd161d.js"><link rel="prefetch" href="/Notebook/assets/js/17.408350d5.js"><link rel="prefetch" href="/Notebook/assets/js/18.6ab68d1c.js"><link rel="prefetch" href="/Notebook/assets/js/19.9e9ef1da.js"><link rel="prefetch" href="/Notebook/assets/js/2.e3a9cac0.js"><link rel="prefetch" href="/Notebook/assets/js/20.56c42c66.js"><link rel="prefetch" href="/Notebook/assets/js/21.8d087c07.js"><link rel="prefetch" href="/Notebook/assets/js/22.cf2b0a03.js"><link rel="prefetch" href="/Notebook/assets/js/23.7413880a.js"><link rel="prefetch" href="/Notebook/assets/js/24.28bab990.js"><link rel="prefetch" href="/Notebook/assets/js/25.75c60686.js"><link rel="prefetch" href="/Notebook/assets/js/26.ef1edf61.js"><link rel="prefetch" href="/Notebook/assets/js/27.5aeea7cc.js"><link rel="prefetch" href="/Notebook/assets/js/28.8476b7e4.js"><link rel="prefetch" href="/Notebook/assets/js/29.956345a3.js"><link rel="prefetch" href="/Notebook/assets/js/30.b96e226e.js"><link rel="prefetch" href="/Notebook/assets/js/31.04440a69.js"><link rel="prefetch" href="/Notebook/assets/js/32.273112ca.js"><link rel="prefetch" href="/Notebook/assets/js/33.e709b2b3.js"><link rel="prefetch" href="/Notebook/assets/js/34.dc2136ae.js"><link rel="prefetch" href="/Notebook/assets/js/35.30ab0118.js"><link rel="prefetch" href="/Notebook/assets/js/36.cb41bc4a.js"><link rel="prefetch" href="/Notebook/assets/js/37.dd26a76e.js"><link rel="prefetch" href="/Notebook/assets/js/38.68398169.js"><link rel="prefetch" href="/Notebook/assets/js/39.93b8990e.js"><link rel="prefetch" href="/Notebook/assets/js/4.5f27db7e.js"><link rel="prefetch" href="/Notebook/assets/js/40.ed267aa9.js"><link rel="prefetch" href="/Notebook/assets/js/41.985eec03.js"><link rel="prefetch" href="/Notebook/assets/js/42.260a858d.js"><link rel="prefetch" href="/Notebook/assets/js/43.6cb97df7.js"><link rel="prefetch" href="/Notebook/assets/js/44.869ede03.js"><link rel="prefetch" href="/Notebook/assets/js/45.bf3e5a26.js"><link rel="prefetch" href="/Notebook/assets/js/46.a54b425c.js"><link rel="prefetch" href="/Notebook/assets/js/47.8ebe066b.js"><link rel="prefetch" href="/Notebook/assets/js/48.416ad307.js"><link rel="prefetch" href="/Notebook/assets/js/49.7394cd78.js"><link rel="prefetch" href="/Notebook/assets/js/5.01244a1f.js"><link rel="prefetch" href="/Notebook/assets/js/50.4675f4c4.js"><link rel="prefetch" href="/Notebook/assets/js/51.a112471f.js"><link rel="prefetch" href="/Notebook/assets/js/52.a6195fbf.js"><link rel="prefetch" href="/Notebook/assets/js/53.15f5f0a8.js"><link rel="prefetch" href="/Notebook/assets/js/54.bbc6eb3c.js"><link rel="prefetch" href="/Notebook/assets/js/55.ba5d1f28.js"><link rel="prefetch" href="/Notebook/assets/js/56.2d5a7c0d.js"><link rel="prefetch" href="/Notebook/assets/js/57.b6f47637.js"><link rel="prefetch" href="/Notebook/assets/js/58.3ce0f8ce.js"><link rel="prefetch" href="/Notebook/assets/js/59.66784ebf.js"><link rel="prefetch" href="/Notebook/assets/js/6.4d03de1b.js"><link rel="prefetch" href="/Notebook/assets/js/60.2c355106.js"><link rel="prefetch" href="/Notebook/assets/js/61.1fb23164.js"><link rel="prefetch" href="/Notebook/assets/js/62.5ee4cd1c.js"><link rel="prefetch" href="/Notebook/assets/js/63.08a71f63.js"><link rel="prefetch" href="/Notebook/assets/js/64.e7464a6a.js"><link rel="prefetch" href="/Notebook/assets/js/65.de9108af.js"><link rel="prefetch" href="/Notebook/assets/js/66.83e75f1b.js"><link rel="prefetch" href="/Notebook/assets/js/67.3caaf58d.js"><link rel="prefetch" href="/Notebook/assets/js/68.2dd69095.js"><link rel="prefetch" href="/Notebook/assets/js/69.927efe78.js"><link rel="prefetch" href="/Notebook/assets/js/70.92fd8264.js"><link rel="prefetch" href="/Notebook/assets/js/71.0ef73e07.js"><link rel="prefetch" href="/Notebook/assets/js/72.7e0a2fee.js"><link rel="prefetch" href="/Notebook/assets/js/73.816bc4b8.js"><link rel="prefetch" href="/Notebook/assets/js/74.e1c44e90.js"><link rel="prefetch" href="/Notebook/assets/js/75.52d5991e.js"><link rel="prefetch" href="/Notebook/assets/js/76.3ab263b9.js"><link rel="prefetch" href="/Notebook/assets/js/77.76e6e752.js"><link rel="prefetch" href="/Notebook/assets/js/78.e2711be8.js"><link rel="prefetch" href="/Notebook/assets/js/79.ecf0c259.js"><link rel="prefetch" href="/Notebook/assets/js/8.698b291a.js"><link rel="prefetch" href="/Notebook/assets/js/80.6defbc57.js"><link rel="prefetch" href="/Notebook/assets/js/81.650b6435.js"><link rel="prefetch" href="/Notebook/assets/js/82.f41e2c82.js"><link rel="prefetch" href="/Notebook/assets/js/83.62a3d0ce.js"><link rel="prefetch" href="/Notebook/assets/js/84.f2e0ba7a.js"><link rel="prefetch" href="/Notebook/assets/js/85.7d5af1cd.js"><link rel="prefetch" href="/Notebook/assets/js/86.883b02f7.js"><link rel="prefetch" href="/Notebook/assets/js/87.dc5913fb.js"><link rel="prefetch" href="/Notebook/assets/js/88.369e5f01.js"><link rel="prefetch" href="/Notebook/assets/js/89.fd496723.js"><link rel="prefetch" href="/Notebook/assets/js/9.220abfab.js"><link rel="prefetch" href="/Notebook/assets/js/90.1d16c82f.js"><link rel="prefetch" href="/Notebook/assets/js/91.6bcdcb57.js"><link rel="prefetch" href="/Notebook/assets/js/92.3f6beaea.js"><link rel="prefetch" href="/Notebook/assets/js/93.d98ca184.js">
    <link rel="stylesheet" href="/Notebook/assets/css/0.styles.4f932b82.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Notebook/" class="home-link router-link-active"><!----> <span class="site-name">Yolanda</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">📝日常记录</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">开发者</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link router-link-active">💻大前端</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">🤔复盘</a></li><li class="dropdown-item"><h4>️️🧘算法修炼</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/algorithm/computerBasics.html" class="nav-link">计算机基础</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">数据结构</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">算法分类</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">数据库</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">☁️运维</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">🚬测试</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">🌍GIS</a></li><li class="dropdown-item"><!----> <a href="/Notebook/software/" class="nav-link">️️🖱️软件</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">️️🐛网络工程</a></li><li class="dropdown-item"><!----> <a href="/Notebook/csharp/" class="nav-link">🚗C#</a></li><li class="dropdown-item"><!----> <a href="/Notebook/unity/" class="nav-link">🎮Unity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">设计</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">🖌️UI</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">🏷书签整理</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">✔️编码规范&amp;协同开发</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://jecyu.github.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">🔗Github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Yolanda177" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Yolanda github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端自动化测试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">📝日常记录</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">开发者</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link router-link-active">💻大前端</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">🤔复盘</a></li><li class="dropdown-item"><h4>️️🧘算法修炼</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/algorithm/computerBasics.html" class="nav-link">计算机基础</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">数据结构</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">算法分类</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">数据库</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">☁️运维</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">🚬测试</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">🌍GIS</a></li><li class="dropdown-item"><!----> <a href="/Notebook/software/" class="nav-link">️️🖱️软件</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">️️🐛网络工程</a></li><li class="dropdown-item"><!----> <a href="/Notebook/csharp/" class="nav-link">🚗C#</a></li><li class="dropdown-item"><!----> <a href="/Notebook/unity/" class="nav-link">🎮Unity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">设计</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">🖌️UI</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">🏷书签整理</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">✔️编码规范&amp;协同开发</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://jecyu.github.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">🔗Github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Yolanda177" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Yolanda github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://jecyu.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端自动化测试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/frontend-web/browser.html" class="sidebar-link">浏览器</a></li><li><a href="/Notebook/frontend-web/css.html" class="sidebar-link">CSS</a></li><li><a href="/Notebook/frontend-web/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/Notebook/frontend-web/es6.html" class="sidebar-link">ES6</a></li><li><a href="/Notebook/frontend-web/react.html" class="sidebar-link">React</a></li><li><a href="/Notebook/frontend-web/vue.html" class="sidebar-link">Vue</a></li><li><a href="/Notebook/frontend-web/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/Notebook/frontend-web/" class="sidebar-link">工程化</a></li><li><a href="/Notebook/frontend-web/modulization.html" class="sidebar-link">模块化</a></li><li><a href="/Notebook/frontend-web/architecture.html" class="sidebar-link">架构</a></li><li><a href="/Notebook/frontend-web/authentication.html" class="sidebar-link">鉴权&amp;&amp;认证</a></li><li><a href="/Notebook/frontend-web/chrome.html" class="sidebar-link">chrome 调试技巧</a></li><li><a href="/Notebook/frontend-web/noJQ.html" class="sidebar-link">You (Might) Don't Need jQuery</a></li><li><a href="/Notebook/frontend-web/performance.html" class="sidebar-link">性能优化</a></li><li><a href="/Notebook/frontend-web/npm.html" class="sidebar-link">npm</a></li><li><a href="/Notebook/frontend-web/lodash.html" class="sidebar-link">lodash 源码分析及思路学习</a></li><li><a href="/Notebook/frontend-web/babel.html" class="sidebar-link">Babel</a></li><li><a href="/Notebook/frontend-web/rollup.html" class="sidebar-link">rollup</a></li><li><a href="/Notebook/frontend-web/docker.html" class="sidebar-link">Docker</a></li><li><a href="/Notebook/frontend-web/security.html" class="sidebar-link">前端安全</a></li><li><a href="/Notebook/frontend-web/file.html" class="sidebar-link">文件处理</a></li><li><a href="/Notebook/frontend-web/interview.html" class="sidebar-link">常见问题 1</a></li><li><a href="/Notebook/frontend-web/interview2.html" class="sidebar-link">常见问题 2</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js"><a href="#js" aria-hidden="true" class="header-anchor">#</a> JS</h1> <blockquote><p>https://github.com/stephentian/33-js-concepts#6-this-call-apply-%E5%92%8C-bind</p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#基础">基础</a><ul><li><a href="#执行上下文">执行上下文</a></li><li><a href="#执行栈">执行栈</a></li><li><a href="#面向对象与原型">面向对象与原型</a></li><li><a href="#ajax">ajax</a></li><li><a href="#fetch-api">Fetch API</a></li><li><a href="#函数">函数</a></li><li><a href="#事件">事件</a></li><li><a href="#创建一个类">创建一个类</a></li></ul></li><li><a href="#进阶">进阶</a><ul><li><a href="#settimeout-setinterval-和-requestanimationframe">setTimeout, setInterval 和 requestAnimationFrame</a></li><li><a href="#this-call-apply-和-bind">this, call, apply 和 bind</a></li><li><a href="#实现一个-call-函数">实现一个 call 函数</a></li><li><a href="#promise">Promise</a></li><li><a href="#async-await">Async/Await</a></li><li><a href="#事件循环和任务队列">事件循环和任务队列</a></li><li><a href="#macrotask-宏任务-、microtask-微任务">Macrotask(宏任务)、Microtask(微任务)</a></li><li><a href="#闭包">闭包</a></li><li><a href="#js-前端模块化">JS 前端模块化</a></li></ul></li><li><a href="#工具函数大全">工具函数大全</a><ul><li><a href="#类型判断">类型判断</a></li><li><a href="#数组">数组</a></li><li><a href="#浏览器操作及其它">浏览器操作及其它</a></li><li><a href="#深拷贝">深拷贝</a></li><li><a href="#字符串拼接">字符串拼接</a></li><li><a href="#js生成某个范围的随机整数">JS生成某个范围的随机整数</a></li><li><a href="#内存管理">内存管理</a></li></ul></li><li><a href="#参考资料">参考资料</a></li></ul></div><p></p> <h2 id="基础"><a href="#基础" aria-hidden="true" class="header-anchor">#</a> 基础</h2> <h3 id="执行上下文"><a href="#执行上下文" aria-hidden="true" class="header-anchor">#</a> 执行上下文</h3> <p>执行上下文是评估和执行JavaScript代码的环境，有三种类型的执行上下文：</p> <ul><li><p>全局执行上下文：默认、基础的上下文，任何不在函数内的代码都在全局上下文中。它会执行两件事：创建一个全局的<code>window</code>对象，并设置<code>this</code>的值等于这个<strong>全局对象</strong>。一个程序中只会有一个全局上下文</p></li> <li><p>函数执行上下文：每当一个函数被调用时，都会为这个函数创建一个新的执行上下文，每个函数都有它自己的执行上下文。每当一个新的执行上下文被创建，它会按定义的顺序执行一系列的步骤</p></li> <li><p>Eval 函数执行上下文：执行在<code>eval</code>函数内的代码也会有它自己的执行上下文，但较少使用该函数</p></li></ul> <h3 id="执行栈"><a href="#执行栈" aria-hidden="true" class="header-anchor">#</a> 执行栈</h3> <p><strong>执行栈</strong>，也就是其他编程语言中所说的“调用栈”，是一种拥有“后进先出”(LIFO)数据结构的栈，被用来存储代码运行时创建的所有执行上下文</p> <p>当 JavaScript 引擎第一次遇到脚本时，会创建一个全局的执行上下文并压入当前的执行栈。每当引擎遇到一个函数调用，它会为该函数创建一个新的执行上下文并压入栈的顶部</p> <p>引擎会执行那些上下文位于栈顶的函数，当该函数执行结束时，执行上下文从栈中弹出，控制流程到达当前栈中的下一个上下文</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Inside first function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Again inside first function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Inside second function'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consolg<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Inside Global Execution Context'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/Notebook/assets/img/zhixingzhan.c3419680.png" alt=""></p> <p>当上述代码在浏览器加载时，JavaScript 引擎创建了一个全局执行上下文并把它压入当前栈。当遇到<code>first()</code>函数调用时，JavaScript引擎为该函数创建了一个新的执行上下文并把它压入当前栈的顶部</p> <p>当<code>first()</code>函数内部调用<code>second()</code>函数时，JavaScript引擎为<code>second()</code>函数创建了一个新的执行上下文，并把它压入当前栈的顶部。当<code>second()</code>函数执行完毕，它的执行上下文会从当前栈弹出，并且控制流程到达下一个执行上下文，即<code>first()</code>函数的执行上下文</p> <p>当<code>first()</code>执行完毕，它的执行上下文从栈弹出，控制流程到达全局执行上下文，一旦所有代码执行完毕，JavaScript 引擎从当前栈中移除全局执行上下文</p> <p>例：以下两段代码有什么区别？执行结果是什么？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">'global scope'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">'local scope'</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">'global scope'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">'local scope'</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行结果都是<code>local scope</code>，它们的调用栈顺序不同：</p> <p>第一段：全局——&gt;函数checkscope()——&gt;函数f()——&gt;出栈——&gt;出栈——&gt;出栈</p> <p>第二段：全局——&gt;函数checkscope()——&gt;出栈——&gt;函数f()——&gt;出栈——&gt;出栈</p> <p><strong>this 绑定</strong></p> <p>在全局执行上下文中，<code>this</code>的值指向全局对象(在浏览器中，<code>this</code>引用Window对象)</p> <p>在函数执行上下文中，<code>this</code>的值取决于该函数是如何被调用的。如果它被一个引用对象调用，那么<code>this</code>就会被设置为那个对象，否则<code>this</code>的值被设置为全局对象或<code>undefined</code>(严格模式下)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">baz</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

foo<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this 指向 foo</span>

<span class="token keyword">let</span> bar <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this 指向 window 对象</span>
</code></pre></div><p><strong>变量对象</strong></p> <p>每一个执行上下文都会分配一个变量对象，变量对象的属性由<strong>变量和函数声明</strong>构成。在函数上下文情况中，参数列表也会被加入到变量对象中作为属性，变量对象与当前作用域息息相关。不同作用域的变量对象互不相同，它保存了当前作用域的所有函数和变量
(要注意的是，<strong>函数声明</strong>会被加入到变量对象中，但<strong>函数表达式</strong>则不会)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function</span>

<span class="token keyword">var</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">_a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>

</code></pre></div><p>进入执行上下文时，首先会处理<strong>函数声明</strong>，其次会处理变量声明，如果变量名跟已经声明的形式参数或函数相同时，则变量声明不会干扰已经存在的这类属性，例：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印函数</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>作用域</strong></p> <p>JavaScript 采用词法作用域(静态作用域)，作用域决定了变量的生命周期及其可见性；函数的作用域在函数定义的时候就决定了。当我们创建了一个函数或<code>{}</code>块，就会生成一个新的作用域，需要注意的是，通过<code>var</code>创建的变量只有函数作用域，而通过<code>let</code>或<code>const</code>创建的变量既有函数作用域，也有块作用域</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  consloe<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印 1</span>
</code></pre></div><h3 id="面向对象与原型"><a href="#面向对象与原型" aria-hidden="true" class="header-anchor">#</a> 面向对象与原型</h3> <h3 id="ajax"><a href="#ajax" aria-hidden="true" class="header-anchor">#</a> ajax</h3> <p><img src="/Notebook/assets/img/ajax.26d6d26c.png" alt="ajax"></p> <p>代码例子，不借助任何库实现 <code>XMLHttpRequest</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Step1: 监听状态</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 异步调用完毕</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 异步调用成功</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Request was unsuccessful: '</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// xhr.open(method: [get, post], url: string, async: [true, false])</span>
<span class="token comment">// async: 默认是 true； 代表异步请求，不会阻塞页面 UI。</span>
<span class="token comment">// 如果 async 为 false，代表同步请求，会阻塞页面直至请求成功后。</span>
<span class="token comment">// Step2: 打开请求</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'README.md'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// GET // 相对路径</span>
<span class="token comment">// Step3: 发送请求</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ajax-有没有破坏-js-单线程机制"><a href="#ajax-有没有破坏-js-单线程机制" aria-hidden="true" class="header-anchor">#</a> ajax 有没有破坏 JS 单线程机制</h4> <ul><li>ajax 设置为 异步</li> <li>ajax 设置为同步
需要等待赋值成功后，再执行后就只能使用回调，可以使用 deferred 、 promise、 asycn/await ，但是注意滥用 async/await 有可能导致同步。</li></ul> <p>我们先看下浏览器线程机制，一般情况下，浏览器有如下四种线程：</p> <ul><li>GUI 渲染线程</li> <li>javaScript 引擎线程</li> <li>浏览器事件触发线程</li> <li>HTTP 请求线程</li></ul> <p>那么这么多线程，它们究竟是怎么同 JS 引擎线程交互的呢？</p> <p>通常，它们的线程间交互<strong>以事件的方式</strong>发生，通过<strong>事件回调方式</strong>予以通知。<u>而事件回调，又是以先进先出的方式添加到<code>任务队列</code>的末尾</u>，等到 js 引擎空闲时，<code>任务队列</code>中排队的任务将会依次被执行。这些事件回调包括 setTimeout, setInterval, click, ajax 异步请求等回调。</p> <p><strong>浏览器中，js 引擎线程会循环从<code>任务队列</code> 中读取事件并且执行，这种运行机制称作 <code>Event Loop</code>（事件循环）。</strong></p> <p>浏览器中，js 引擎首先生成 <code>XMLHttpRequest</code> 实例对象，open 过后再调用 send 方法。至此，所有的语句都是同步执行。但从 send 方法内部开始，浏览器为将要发生的网络请求创建了<strong>新的 http 请求线程</strong>，这个线程独立于 js 引擎线程。于是网络请求异步被发送出去了。另一方面，js 引擎并不会等待 ajax 发起的 http 请求收到结果，而是直接顺序往下执行。</p> <p>当 ajax 请求被服务器响应并且收到 response 后，浏览器事件触发线程捕获到 ajax 的回调事件 <code>onreadystatechange(当然也可能触发 onload，或者 onerror 等等)</code>。该回调事件并没有被立即执行，而是被添加到<code>任务队列</code>的末尾，直到 js 空闲了，<code>任务队列</code>的任务才被捞出来，按照添加顺序，挨个执行，当然也包括刚刚 append 到队列末尾的 <code>onreadystatechange</code> 事件。</p> <p>在<code>onreadystatechange</code>事件内部，有可能对 dom 进行操作。此时浏览器便会挂起 js 引擎线程，转而执行 GUI 渲染线程，进行 UI 重绘（repaint）或者回流（reflow）。当 js 引擎重新执行时，GUI 渲染线程又会被挂起，GUI 更新将被保存起来，等到 js 引擎空闲时立即被执行。</p> <p>以上整个 ajax 请求过程中，有涉及到浏览器的4种线程，其中除了 <code>GUI 渲染线程</code>和<code>js 引擎线程</code>是互斥的，其他线程相互之间，都是可以并行执行的，通过这样的一种方式，ajax 并没有破坏 js 的单线程机制。</p> <p>然后要注意的是，当你设置 ajax 的 async 为 false 时（一般是为了先获取请求后的数据，给指定变量进行赋值或执行特点函数），这个时候进行的同步操作处理。这个时候并没有启动单独的线程，还是在 js 主线程执行，所以浏览器的 <code>GUI 渲染线程</code>会被阻塞掉。因此，针对这种情况的话，只能通过回调来处理。（deferred、promise 等）</p> <h3 id="fetch-api"><a href="#fetch-api" aria-hidden="true" class="header-anchor">#</a> Fetch API</h3> <h3 id="函数"><a href="#函数" aria-hidden="true" class="header-anchor">#</a> 函数</h3> <p>JS 中的函数调用</p> <ul><li>作为一个函数调用</li> <li>函数作为方法调用</li> <li>使用构造函数调用函数</li> <li>作为函数方法调用函数</li></ul> <h3 id="事件"><a href="#事件" aria-hidden="true" class="header-anchor">#</a> 事件</h3> <h4 id="事件阶段"><a href="#事件阶段" aria-hidden="true" class="header-anchor">#</a> 事件阶段</h4> <ul><li>事件冒泡
事件从最开始时由最具体的元素（文档中嵌套层次最深的那个节点）接收，然后逐级向上传播较为不具体对的节点（文档）。</li></ul> <p>下面点击了页面中的 <code>&lt;div&gt;</code>元素后，click 事件首先在 <code>&lt;div&gt;</code>发生，然后 click 事件沿着 DOM 树向上传播，在每一级节点上都会发生，直至 document 对象。</p> <p><img src="/Notebook/assets/img/event_bubbling.d307902d.png" alt="事件冒泡"></p> <ul><li>事件捕获
事件捕获的思想是不太具体的节点应该更早接收到事件，而最具体的节点应该最后接收到事件。</li></ul> <p>下面点击了页面中的 <code>&lt;div&gt;</code>元素后，click 事件首先在 <code>document</code>对象发生，然后 click 事件沿着 DOM 树向下传播，在每一级节点上都会发生，直至 <code>&lt;div&gt;</code>元素。</p> <p><img src="/Notebook/assets/img/event_capturing.dd51275e.png" alt="事件捕获"></p> <ul><li>DOM 事件流（现代浏览器）</li></ul> <p>下面点击了页面中的 <code>&lt;div&gt;</code>元素后，click 事件首先在 <code>document</code>对象发生，然后 click 事件沿着 DOM 树向下传播，在每一级节点上都会发生，直至 <code>&lt;div&gt;</code>元素，然后继续往上冒泡。</p> <p><img src="/Notebook/assets/img/dom_event.2ea7647c.png" alt="事件冒泡"></p> <p>了解事件的传播有利于我们针对元素进行合适的事件监听。</p> <h4 id="事件监听"><a href="#事件监听" aria-hidden="true" class="header-anchor">#</a> 事件监听</h4> <p>现代浏览器的 DOM 2 级，事件流模型：捕获阶段-目标阶段-冒泡阶段</p> <p><strong>DOM0级事件处理程序</strong></p> <p><u>通过 JavaScript 指定事件处理程序的传统方式，就是将一个函数赋值给一个事件处理程序属性。</u>这种为事件处理程序赋值的方法是在第四代 Web 浏览器中出现的，而且至今仍然为所有现代浏览器所支持。原因一是简单，二是具有跨浏览器的优势。要使用 JavaScript 指定事件处理程序，首先必须取得一个要操作的对象的引用。</p> <p>每个元素（包括 window 和 document）都有自己的事件处理程序属性，这些属性通常全部小写。例如 <code>onclick</code>。将这种属性的值设置为一个函数，就可以指定事件处理程序：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myBtn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// this 指向当前元素</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Clicked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 删除事件处理哦程序</span>
btn<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre></div><p>以这种方式添加的事件处理程序会在事件流的冒泡阶段被处理。</p> <p><strong>DOM2事件处理程序</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @description: 事件监听
 * @param {String} 字符串，指定事件名
 * @param {Function} 指定要事件触发时执行的函数
 * @param {Boolean} 布尔值，指定事件是否在捕获或冒泡阶段执行
 * @return:
 */</span>
element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">,</span> userCapture<span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @description: 事件移除
 * @param {String} 字符串，指定事件名
 * @param {Function} 指定要事件触发时执行的函数
 * @param {Boolean} 布尔值，指定事件是否在捕获或冒泡阶段执行
 * @return:
 */</span>
element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">,</span> userCapture<span class="token punctuation">)</span>
</code></pre></div><p>Internet Explorer 8 及更早 IE 版本: 目标阶段-冒泡阶段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 事件监听：</span>
element<span class="token punctuation">.</span><span class="token function">attatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span>
<span class="token comment">// 代码移除事件监听：</span>
element<span class="token punctuation">.</span><span class="token function">detachEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="事件对象"><a href="#事件对象" aria-hidden="true" class="header-anchor">#</a> 事件对象</h4> <ul><li>DOM 事件模型中的事件对象常用属性：
<ul><li>type 用于获取事件类型</li> <li>target 获取事件目标</li> <li>stopPropagation 阻止事件冒泡</li> <li>preventDefault 阻止事件默认行为</li></ul></li> <li>IE 事件模型中常见的事件对象常用属性
<ul><li>type 用于获取事件类型</li> <li>srcElement 获取事件目标</li> <li>cancelBubble 阻止事件冒泡</li> <li>returnValue 阻止事件默认行为</li></ul></li></ul> <h4 id="事件委托-代理"><a href="#事件委托-代理" aria-hidden="true" class="header-anchor">#</a> 事件委托/代理</h4> <p>使用事件委托的原因：首先，在页面中添加了大量的事件处理程序，每个函数都是对象，都会占用内存；内存中的对象越多，性能就越差。其次，必须事先指定所有事件处理程序而导致的 DOM 访问次数，会延迟整个页面的交互就绪时间。</p> <p>因此，对“事件处理程序过多”的问题解决方案就是事件委托，原理是利用了事件冒泡，只指定一个事件处理程序，就可以管理某一类型的所有事件。例如，click 事件会一直冒泡到 document 层次。也就是说，我们可以为整个页面指定一个 onclick 事件处理程序，而不必给每个可单击的元素分别添加事件处理程序。</p> <p>常见的例子，是针对列表：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>one<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>two<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>child<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>three<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 父元素</span>
  <span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#parent'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 父元素绑定事件，代理子元素的点击事件</span>
  dom<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> event <span class="token operator">=</span> event <span class="token operator">||</span> window<span class="token punctuation">.</span>event<span class="token punctuation">;</span>
    <span class="token keyword">const</span> curTarget <span class="token operator">=</span> event<span class="token punctuation">.</span>target <span class="token operator">||</span> event<span class="token punctuation">.</span>scrElement<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>curTarget<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'li'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 事件处理</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>总结：事件委托可以节省内存占用，减少事件注册；对于新增子对象时无需再次对其绑定事件，适合动态添加元素。除了事件委托外，在页面卸载时，我们要及时移除事件处理程序，避免造成内存泄漏。在移除 dom 元素时，先把它绑定的事件处理程序移除。</p> <h4 id="实现事件模型"><a href="#实现事件模型" aria-hidden="true" class="header-anchor">#</a> 实现事件模型</h4> <p>todo</p> <h4 id="事件广播-📢"><a href="#事件广播-📢" aria-hidden="true" class="header-anchor">#</a> 事件广播 📢</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// listener for the event</span>
element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Dispatch the event</span>
element<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 人工触发</span>
</code></pre></div><h3 id="创建一个类"><a href="#创建一个类" aria-hidden="true" class="header-anchor">#</a> 创建一个类</h3> <h4 id="面向对象的方式（es5）"><a href="#面向对象的方式（es5）" aria-hidden="true" class="header-anchor">#</a> 面向对象的方式（ES5）</h4> <p>组合使用构造函数模式与原型模式。构造函数模式用于定义实例属性，而原型模式用于定义方法和共享的属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Point</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="es6-的-class"><a href="#es6-的-class" aria-hidden="true" class="header-anchor">#</a> ES6 的 class</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>函数声明</strong>和<strong>类声明</strong>之间的一个重要区别是函数声明会提升，类声明不会。你首先需要声明你的类，然后访问它，否则像下面的代码会抛出一个<code>ReferenceError</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ReferenceError</span>
<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="jquery-的链式调用"><a href="#jquery-的链式调用" aria-hidden="true" class="header-anchor">#</a> jQuery 的链式调用</h4> <p>模拟 JQuery 的链式调用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">JQuery</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  val nodeLists <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementByTagName</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodeLists<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>nodeLists<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">JQuery</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">eq</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">css</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prop<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">show</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'display'</span><span class="token punctuation">,</span> <span class="token string">'block'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function-variable function">$</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JQuery</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token string">'200px'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>jQuery 之所以能实现链式调用，关键就在于通过 <code>return this</code>，返回调用对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> jQuery <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">eq</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用 eq 方法'</span><span class="token punctuation">)</span>；
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">show</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用 show 方法'</span><span class="token punctuation">)</span>；
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
jQuery<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="jquery-插件"><a href="#jquery-插件" aria-hidden="true" class="header-anchor">#</a> jQuery 插件</h4> <p>另外，了解这个链式调用原理，也有利于我们理解 jQuery 的插件开发，源码中 jquery.fn = jquery.prototype，也就说 <code>jquery.fn</code> 对象就是 <code>jQuery</code> 的原型对象，<code>jQuery</code> 插件就是用来扩展 <code>jQuery</code> 原型对象的一个方法，而<code>jQuery</code>插件的使用方法就是 <code>jQuery</code> 对象方法的调用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function-variable function">changeStyle</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">colorStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> colorStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 满足链式调用</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>jQuery<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用了立即执行函数，避免 $ 符号的污染其他 js 库</span>
</code></pre></div><p>参考资料：<a href="https://juejin.im/entry/57a1b817c4c971005af56343" target="_blank" rel="noopener noreferrer">掌握 jQuery 插件开发，这篇文章就够了<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 从概念到实战，讲清了 jQuery 插件的开发。</p> <h2 id="进阶"><a href="#进阶" aria-hidden="true" class="header-anchor">#</a> 进阶</h2> <h3 id="settimeout-setinterval-和-requestanimationframe"><a href="#settimeout-setinterval-和-requestanimationframe" aria-hidden="true" class="header-anchor">#</a> setTimeout, setInterval 和 requestAnimationFrame</h3> <h3 id="this-call-apply-和-bind"><a href="#this-call-apply-和-bind" aria-hidden="true" class="header-anchor">#</a> this, call, apply 和 bind</h3> <h4 id="this-的指向"><a href="#this-的指向" aria-hidden="true" class="header-anchor">#</a> this 的指向</h4> <p>在 ES5 中，其实 this 的指向，始终坚持一个原理：<strong>this 永远指向最后调用它的那个对象</strong></p> <ol><li>例子：这里调用 <code>a</code> 的地方 <code>a()</code>;，前面没有调用的对象那么就是全局对象 <code>window</code>，这就相当于是 <code>window.a()</code>；注意，这里我们没有使用严格模式，如果使用严格模式的话，全局对象就是 <code>undefined</code>，那么就会报错 <code>Uncaught TypeError: Cannot read property 'name' of undefined。</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'windowsName'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Cherry'</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// windowsName</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inner:'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// inner: Window</span>
<span class="token punctuation">}</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'outer: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// outer: Window</span>
</code></pre></div><ol start="2"><li>例子： 函数 fn 是对象 a 调用的，所以打印的值就是 a 中的 name 的值，上下文对象调用。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'windowsName'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Cherry'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cherry</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 上下文对象调用</span>
</code></pre></div><ol start="3"><li>函数别名</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'windowName'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Cherry'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cherry</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
<span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined b 被全局对象调用</span>
</code></pre></div><ol start="4"><li>例子：传入回调函数，参数赋值，在不使用箭头函数的情况下，是会报错的，因为最后调用 <code>setTimeout</code> 的对象是 <code>window</code>，但是在 <code>window</code> 中并没有 <code>func1</code> 函数。
setTimeout 方法本身就是 window 对象的一个方法，所以<code>setTimeout</code>在调用的时候，本身就是<code>window</code>在调用它，方法体内的<code>this</code>根据【方法的 this 永远指向最后调用它的 this】,</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'windowsName'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Cherry'</span><span class="token punctuation">,</span>

  <span class="token function-variable function">func1</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">func2</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this.func1 is not a function</span>
</code></pre></div><h4 id="改变-this-的指向"><a href="#改变-this-的指向" aria-hidden="true" class="header-anchor">#</a> 改变 this 的指向</h4> <h5 id="使用-es6-的箭头函数"><a href="#使用-es6-的箭头函数" aria-hidden="true" class="header-anchor">#</a> 使用 ES6 的箭头函数</h5> <h5 id="在函数内部使用-this-this"><a href="#在函数内部使用-this-this" aria-hidden="true" class="header-anchor">#</a> 在函数内部使用 <code>_this=this</code></h5> <h5 id="new-实例化一个对象"><a href="#new-实例化一个对象" aria-hidden="true" class="header-anchor">#</a> new 实例化一个对象</h5> <h5 id="使用apply、call、bind"><a href="#使用apply、call、bind" aria-hidden="true" class="header-anchor">#</a> 使用<code>apply</code>、<code>call</code>、<code>bind</code></h5> <ol><li>apply
<ul><li>apply() 方法调用一个函数，其具有一个指定的 this 值，以及作为一个数组（或类似数组的对象）提供的参数。</li> <li><code>fun.apply(thisArg, [argsArray])</code> <ul><li>thisArg: 在 fun 函数运行时指定的 this 值。需要注意的是，指定的 this 值并不一定是该函数执行时真正的 this 值，如果这个函数处于非严格模式下，则指定为 null 或 undefined 时会自动指向全局对象（浏览器中就是 window 对象），同时值为原始值（数字，字符串，布尔值）的 this 会指向该原始值的自动包装对象。</li> <li>argsArray：一个数组或者类数组对象，其中的数组元素将作为单独的参数传给 fun 函数。如果该参数的值为 null 或 undefined，则表示不需要传入任何参数。</li></ul></li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Cherry'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
<span class="token function">b</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><ol start="2"><li>call
<ul><li><code>fun.call(thisArg, [, arg1[, arg2[, ...]]])</code></li> <li>apply 和 call 的区别时只是传入的参数不同，call 方法接受的是若干个参数列表，而 apply 接受的是一个包含多个参数的数组。</li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Cherry'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
<span class="token function">b</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre></div><ol start="3"><li>bind<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener noreferrer">MDN bind<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <ul><li><code>bind()</code> 方法创建一个新的函数，在<code>bind()</code>被调用时，这个新函数的<code>this</code>被 bind 的第一个参数指定，其余的参数将作为新函数的参数供调用时使用。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Cherry'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a + b ='</span><span class="token punctuation">,</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
<span class="token function">b</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token function">b</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token keyword">const</span> newFn <span class="token operator">=</span> <span class="token function">b</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bind 是创建一个新的函数，我们必须手动去调用</span>
<span class="token function">newFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="小结"><a href="#小结" aria-hidden="true" class="header-anchor">#</a> 小结</h4> <p>如果要判断一个运行中函数的 <code>this</code>绑定，<strong>就需要找到这个函数的直接调用位置</strong>。找到之后就可以顺序应用下面这四条规则来判断 this 的绑定对象。</p> <ol><li>由 <code>new</code> 调用？<u>绑定到新创建的对象。</u></li> <li>由 <code>call</code> 或者 <code>apply</code> （或者 <code>bind</code>）调用？<u>绑定到指定的对象</u>。</li> <li>由上下文对象调用？<u>绑定到那个上下文对象。</u></li> <li>默认：在严格模式下绑定到 <code>undefined</code>，否则<u>绑定到全局对象</u>。</li></ol> <p>一定要注意，有些调用可能在无意中使用默认绑定规则。如果想“更安全”地忽略 <code>this</code> 绑定，你可以使用一个 DMZ 对象，比如 <code>⌀ = Object.create(null)</code>，以保护全局对象。
ES6 中的箭头函数不会使用四条标准的绑定规则，而是根据当前的词法作用域来决定 this，具体来说，箭头函数会继承外层函数调用的 this 绑定（无论 this 绑定到什么）。这其实和 ES6 之前代码中的 <code>self = this</code>机制一样。</p> <h3 id="实现一个-call-函数"><a href="#实现一个-call-函数" aria-hidden="true" class="header-anchor">#</a> 实现一个 call 函数</h3> <h3 id="promise"><a href="#promise" aria-hidden="true" class="header-anchor">#</a> Promise</h3> <h4 id="回调"><a href="#回调" aria-hidden="true" class="header-anchor">#</a> 回调</h4> <p>JavaScript 是单线程的，这意味者任何两句代码都不能同时运行，它们得一个接一个来。在浏览器中，JavaScript 和 其他任务共享一个线程，不同的浏览器略有差异，但大体上这些和 JavaScript 共享线程的任务包括重绘、更新样式、用户交互等，所有这些任务操作都会阻塞其他任务。</p> <p>作为人类，你是多线程的。你可以用多个手指同时敲键盘，也可以一边开车一边听电话。唯一的全局阻塞函数是打喷嚏，打喷嚏期间所有其他事务都会暂停。</p> <p>你应该用事件加回调的办法来处理这类情况：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> img1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.img-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
img1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// woo yey image loaded</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
img1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// argh everything's broken</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的例子唯一的问题是，事件有可能在我们绑定监听器之前就已经发生，所以我们先要检查图片的 complete 属性：</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> img1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.img-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">function</span> <span class="token function">loaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// woo yey image loaded</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">if</span> <span class="token punctuation">(</span>img1<span class="token punctuation">.</span>complete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">loaded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  img1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> loaded<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
img1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// argh everything's broken</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样还不够，如果在添加监听函数之前图片加载发生错误，我们的监听函数还是白费，不幸的是 DOM 也没有为这个需求提供解决方法。而且，这只是处理一张图片的情况，如果有一堆图片要处理那就更麻烦了。</p> <p>初次之外，你还可能会遇到这种情况，回调的不断嵌套。</p> <div class="language-js extra-class"><pre class="language-js"><code>input<span class="token punctuation">.</span>onblur <span class="token operator">=</span> isUserTooYoung<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">isUserTooYoung</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">openDatabase</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">col</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">find</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'id'</span><span class="token punctuation">:</span> id<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       result<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">callback</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>age <span class="token operator">&lt;</span> cutoffAge<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div><h4 id="promise-2"><a href="#promise-2" aria-hidden="true" class="header-anchor">#</a> Promise</h4> <p>事件不是万金油</p> <p>事件机制最适合处理同一个对象上反复发生的事情——keyup、touchstart 等等。你不需要考虑当绑定监听器之前所发生的事情，当碰到异步请求成功/失败的时候，你想要的通常是这样：</p> <div class="language-js extra-class"><pre class="language-js"><code>img1<span class="token punctuation">.</span><span class="token function">callThisIfLoadedOrWhenLoaded</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// loaded</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orIfFailedCallThis</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// failed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// and ..</span>
<span class="token function">whenAllTheseHaveLoaded</span><span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">callThis</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// all loaded</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orIfSomeFailedCallThis</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// one or more failed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这就是 Promise。如果 HTML 图片元素有一个 ready() 方法的话，我们就可以这样：</p> <div class="language-js extra-class"><pre class="language-js"><code>img1<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// loaded</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// failed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// and...</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>img1<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img2<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// all loaded</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// one or more failed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>基本上 Promise 还是有点像事件回调，除了：</p> <ul><li>一个 Promise 只能成功或失败一次，并且状态无法改变（不能从成功变为失败，反之亦然）</li> <li>如果一个 Promise 成功或失败之后，你为其添加针对成功/失败的回调，则相应的回调函数会立即执行。</li></ul> <p>这些特性非常适合处理异步操作的成功/失败情景，你无需担心事件发生的时间点，而只需对其做出响应。</p> <h4 id="promise-相关术语"><a href="#promise-相关术语" aria-hidden="true" class="header-anchor">#</a> Promise 相关术语</h4> <p><code>Promise</code> 是一个对象，它代表了一个异步操作的最终完成或者失败。
本质上，Promise 是一个被某些函数传出的对象，我们附加回调函数（callback）使用它，而不是将回调函数传入那些函数内部。</p> <p>一个 Promise 的状态可以是：</p> <ul><li>确认（fulfilled）：成功了。</li> <li>否定（rejected）：失败了。</li> <li>等待（pending）：还没有确认活着否定，进行中。</li> <li>结束（settled）：已经确认或者否定了。</li></ul> <h4 id="实战"><a href="#实战" aria-hidden="true" class="header-anchor">#</a> 实战</h4> <ul><li>显示一个加载指示图标</li> <li>加载一篇小说的 JSON，包含小说名和每一章内容的 URL。</li> <li>在页面中填上小说名</li> <li>加载所有章节正文</li> <li>在页面中添加章节正文</li> <li>停止加载指示
...这个过程中如果发生了什么错误要通知用户，并且把加载指示停掉，不然它就会不停转下去。<strong>这个模式是典型的 API 请求模式：获取多个数据，当它们全部完成之后再做一些事件。</strong></li></ul> <p><strong>将 Promise 用于 XMLHttpRequest</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回一个 Promise</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      req<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>

      req<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 处理网络错误</span>
      req<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Network Error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 发起请求</span>
      req<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>  

  <span class="token comment">// 调用</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'story.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Failed! :'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>链式调用：</strong></p> <ol><li>处理值</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 调用</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'story.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// JSON 解析</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Yey JSON!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>处理异步</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span>parse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'story.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>chapterUrls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Got chapter 1'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>错误处理</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 调用</span>
 <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'story.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// return getJSON(response.chapterUrls[01])</span>
   <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>chapterUrls<span class="token punctuation">[</span><span class="token number">03</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 测试请求失败</span>
   <span class="token comment">// 如果请求 story.chapterUrls[0] 失败（http 500 或者用户掉线什么的）了，它会跳过之后所有针对成功的回调，包括 getJSON 中将响应解析为 JSON 的回调，和这里把第一张内容添加到页面里的回调。JavaScript 的执行会进入 catch 回调。</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Got chapter 1'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">addHtmlToPage</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token comment">// 如果只是要捕捉异常做记录输出，不打算在用户界面上对错误进行反馈的话，只要抛出 Error 就行了</span>
   <span class="token comment">// throw (err);</span>
   <span class="token function">addTexdtToPage</span><span class="token punctuation">(</span><span class="token string">'Failed to show chapter'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 捕获完错误后，下面的代码继续执行</span>
   document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.spinner-border'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>串行请求</strong></p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 调用</span>
 <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'story.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 利用 reduce 及 Promise.resolve() 并法队列调用，按照加入的顺序，浏览器按顺序进行请求</span>
   <span class="token keyword">return</span> response<span class="token punctuation">.</span>chapterUrls<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sequence<span class="token punctuation">,</span> chapterUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> sequence<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// 获取下一章节</span>
       <span class="token keyword">return</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>chapterUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chapter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token function">addHtmlToPage</span><span class="token punctuation">(</span>chapter<span class="token punctuation">.</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">addTextToPage</span><span class="token punctuation">(</span><span class="token string">&quot;All done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">addTextToPage</span><span class="token punctuation">(</span><span class="token string">'Failed to show chapter'</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.spinner-border'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>并行请求</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 调用</span>
<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'story.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>chapterUrls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getJSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chapters</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chapters<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chapter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">addHtmlToPage</span><span class="token punctuation">(</span>chapter<span class="token punctuation">.</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">addTextToPage</span><span class="token punctuation">(</span><span class="token string">&quot;All done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">addTextToPage</span><span class="token punctuation">(</span><span class="token string">'Failed to show chapter'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.spinner-border'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="promise-和-generator"><a href="#promise-和-generator" aria-hidden="true" class="header-anchor">#</a> Promise 和 Generator</h4> <p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator" target="_blank" rel="noopener noreferrer">Generator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，允许函数在特定地方像 return 一样退出，但是稍后又能恢复到这个位置和状态上继续执行。</p> <p>注意函数名前的星号，这表示该函数是一个 Generator。关键字 yield 标记了暂停/继续的位置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">addGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     i <span class="token operator">+=</span> <span class="token keyword">yield</span> i<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">const</span> adder <span class="token operator">=</span> <span class="token function">addGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成器对象</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adder<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adder<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adder<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adder<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>adder<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 65</span>
</code></pre></div><p>这对 Promise 有什么用呢？可以使用这种暂停/继续的机制写出来和同步代码看起来差不多的代码，假设如下使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    ret <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step2</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ret <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step2Failed</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  ret <span class="token operator">=</span> <span class="token keyword">yield</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>
    <span class="token function">step3a</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">step3b</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">step3c</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">yield</span> <span class="token function">step4</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>具体实现</strong>：</p> <h4 id="手写-promise"><a href="#手写-promise" aria-hidden="true" class="header-anchor">#</a> 手写 Promise</h4> <h3 id="async-await"><a href="#async-await" aria-hidden="true" class="header-anchor">#</a> Async/Await</h3> <h4 id="什么是-async-await"><a href="#什么是-async-await" aria-hidden="true" class="header-anchor">#</a> 什么是 Async/Await</h4> <p>Async - 定义异步函数（<code>async function someName(）{...}</code>)</p> <ul><li>自动把函数转为 Promise</li> <li>当调用异步函数时，函数返回值会被 resolve 处理</li> <li>异步函数内部可以使用 await</li></ul> <p>Await - 暂停异步函数的执行（<code>var result = await someAsyncCall()</code>）</p> <ul><li>当使用在 Promise 前面时，<code>await</code>等待 Promise 完成，并返回 Promise 的结果。</li> <li><code>await</code> 只能和 Promise 一起使用，不能和 callback 一起使用</li> <li><code>await</code> 只能用在 <code>async</code> 函数中。</li></ul> <h4 id="async-await-是否会取代-promise"><a href="#async-await-是否会取代-promise" aria-hidden="true" class="header-anchor">#</a> Async/Await 是否会取代 Promise</h4> <p>不会。</p> <ul><li>Async/Await 底层依然使用了 Promise。</li> <li>多个异步函数同时执行时，需要借助 <code>Promise.all</code></li></ul> <p>每次遇到 await 关键字时，Promise 都会停下在，一直到运行结束。<code>await</code> 把异步代码变成了同步代码。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> story <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'story.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">addHtmlToPage</span><span class="token punctuation">(</span>story<span class="token punctuation">.</span>heading<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 1. 串行请求按顺序执行</span>
      <span class="token comment">// for (let url of story.chapterUrls) {</span>
      <span class="token comment">//   let chapter = await getJSON(url); // 返回 promise.resolve 的值</span>
      <span class="token comment">//   addHtmlToPage(chapter.html);</span>
      <span class="token comment">// }</span>
      
      <span class="token comment">// 2. 并行请求</span>
      <span class="token keyword">let</span> chapterPromises <span class="token operator">=</span> story<span class="token punctuation">.</span>chapterUrls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getJSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> chapters <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>chapterPromises<span class="token punctuation">)</span><span class="token punctuation">;</span>
      chapters<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">chapter</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">addHtmlToPage</span><span class="token punctuation">(</span>chapter<span class="token punctuation">.</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token function">addTextToPage</span><span class="token punctuation">(</span><span class="token string">'All done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">addTextToPage</span><span class="token punctuation">(</span><span class="token string">'broken'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.spinner-border'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="捕获错误"><a href="#捕获错误" aria-hidden="true" class="header-anchor">#</a> 捕获错误</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">asyncAwaitTryCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> friends <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getFriend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">throwError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error was not thrown'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> photo <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getPhoto</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async/await'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> friends<span class="token punctuation">,</span> photo <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="组合"><a href="#组合" aria-hidden="true" class="header-anchor">#</a> 组合</h4> <ul><li>调用 async 函数作为一个 promise 对象来返回数据</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> friends<span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getFriends</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">const</span> photo <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getPhoto</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>user<span class="token punctuation">,</span> friends<span class="token punctuation">,</span> photo <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">promiseUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> friends<span class="token punctuation">,</span> photo <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promiseUserInfo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> friends<span class="token punctuation">,</span> photo <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 或者继续使用 async/await 语法</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">awaitUserInfo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> friends<span class="token punctuation">,</span> photo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'awaitUserInfo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> friends<span class="token punctuation">,</span> photo <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>检索前十个用户的所有数据</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getLotsOfUserData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>users<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'getLotsOfUserData'</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>并发请求</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getLotsOfUserDataFaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> userPromises <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>userPromises<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'getLotsOfUserDataFaster'</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="事件循环和任务队列"><a href="#事件循环和任务队列" aria-hidden="true" class="header-anchor">#</a> 事件循环和任务队列</h3> <p>JavaScript 时单线程执行的，无法同时执行多段代码。当某一段代码正在执行的时候，所有后续的任务都必须等待，形成一个队列。一旦当前任务执行完毕，再从队列中取出下一个任务，这也常称为“阻塞式执行”。所以一次鼠标点击，或者计时器到达时间点，或是 Ajax 请求完成触发了回调函数，这些事件处理程序或回调函数都不会立即执行，而是立即排队，一旦线程有空闲就执行。</p> <p>假如当前 JavaScript 线程正在执行一段很耗时的代码，此时发生了一次鼠标点击，那么事件处理程序就被阻塞，用户也无法立即看到反馈，事件处理程序会被放入任务队列，直到前面的代码结束以后才会开始执行。如果代码中设定了一个 <code>setTimeout</code>，那么浏览器便会在合适的时间，将代码插入任务队列，如果这个时间设为0，就代表立即插入队列，但不是立即执行，仍然要等待前面代码执行完毕。所以 <code>setTimeout</code> 并不能保证执行的时间，是否及时执行取决于 JavaScript 线程是拥挤还是空闲。</p> <p>由上可知，<code>setTimeout</code>并不是异步的，而是将其操作插入到 js 线程中，排队执行，造成异步的假象，这时 setTimeout 立即将 ajax 排到 js 线程中，仍然会造成 ui 阻塞。</p> <p><strong>事件循环</strong> <img src="/Notebook/assets/img/eventloop.83c4c4f2.png" alt=""></p> <p>先看一个小栗子：当JS引擎运行时，会将代码压入执行栈进行执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>入栈：当代码被解析后，函数依次被压入栈
<img src="/Notebook/assets/img/inloop.8ac0691d.png" alt="">
出栈：当函数c执行完后，开始出栈
<img src="/Notebook/assets/img/outloop.e2396394.png" alt=""></p> <p>tip:</p> <ul><li>Call Stack 执行栈 <strong>先进后出</strong></li> <li>Callback Queue 回调队列 <strong>先进先出</strong></li> <li>Web Apis 浏览器功能，专门维护事件</li></ul> <p><strong>当执行栈遇到异步</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sync'</span><span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">setTimeOut</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><p>总过程: 打印 &gt; 添加点击事件 &gt; setTimeout
<img src="/Notebook/assets/img/inloop2.e4b4e48c.png" alt=""></p> <p>分析1: 浏览器在执行栈执行时，发现有异步任务后，会交给webapi去维护，而执行栈会继续执行后面的任务
<img src="/Notebook/assets/img/inloop3.57ed8c43.png" alt=""></p> <p>分析2: 同样，setTimeout也会被添加到webapi中，setTimeout旁边有个进度条，这个进度条就是设置的等待时间
<img src="/Notebook/assets/img/inloop4.6fb14d6f.png" alt=""></p> <p>分析3: 当setTimeout执行结束后，是不是就回到执行栈呢？答案是否的，倒计时结束后setTimeout的可执行函数，被放入了回调队列，<strong>只有当执行栈的任务为空时</strong>，才会从回调队列中取出放入执行
<img src="/Notebook/assets/img/inCallbackQueue.aa9d9fd8.png" alt=""></p> <p><img src="/Notebook/assets/img/inStack.51cf1e94.png" alt=""></p> <p>再看一个栗子：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><p>上面代码依次输出：1，5，2，4，3
分析：</p> <ol><li>输出1，将2push进回调队列</li> <li>将4push进回调队列</li> <li>输出5</li> <li>清空执行栈，读取输出2，将3push进回调队列</li> <li>清空执行栈，读取输出4</li> <li>清空执行栈，读取输出3</li></ol> <h3 id="macrotask-宏任务-、microtask-微任务"><a href="#macrotask-宏任务-、microtask-微任务" aria-hidden="true" class="header-anchor">#</a> Macrotask(宏任务)、Microtask(微任务)</h3> <p>通过上面的例子，想必对 event loop 有了一定的了解，现在继续看一个例子</p> <div class="language-js extra-class"><pre class="language-js"><code>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><p>按照 event loop 的概念，输出应该是1，3，5，2，4，因为 setTimeout 和 then 会被放入回调队列，然后先进先出，所以应该是2先输出，4后输出</p> <p>但实际输出结果是1，3，5，4，2，为什么呢？因为 promise 的 then 方法被认为是在 Microtask 微任务队列中</p> <p><strong>什么是Macrotask(宏任务)？</strong></p> <p>宏任务就是前面介绍过的回调队列 Callback Queue</p> <p><strong>什么是Microtask(微任务)？</strong></p> <p>微任务同样也是一个任务队列，只是执行顺序是在清空执行栈之后</p> <p><img src="/Notebook/assets/img/eventloop.83c4c4f2.png" alt=""></p> <p>从这张图可以看到，Macrotask(微任务)虽然是队列，但<strong>并不是一个个放入执行栈</strong>，而是当执行栈清空，就会执行全部Microtask(微任务)队列中的任务，最后才是取回调队列的第一个Macrotask(宏任务)</p> <p><strong>如何分清宏任务还是微任务？</strong></p> <p>除了 then 以外，还有几个事件也被记为微任务：</p> <ul><li>process.nextTick (node环境下，浏览器环境会变成宏任务)</li> <li>Object.observe</li> <li>MutationObserver</li></ul> <p>注意：process.nextTick 和 then 不太一样，process.nextTick 是加入到执行栈底部，所以和其他微任务表现不一致</p> <p>(node 环境)</p> <div class="language- extra-class"><pre class="language-text"><code>console.log(&quot;1&quot;);
setTimeout(()=&gt;{
    console.log(2)
    Promise.resolve().then(()=&gt;{
        console.log(3);
        process.nextTick(function foo() {
            console.log(4);
        });
    })
})
Promise.resolve().then(()=&gt;{
    console.log(5);    
    setTimeout(()=&gt;{
        console.log(6)
    })
    Promise.resolve().then(()=&gt;{
        console.log(7);
    })
})

process.nextTick(function foo() {
    console.log(8);
    process.nextTick(function foo() {
        console.log(9);
    });
});
console.log(&quot;10&quot;)

</code></pre></div><ol><li>输出1，将2push进回调队列</li> <li>将5push进微任务队列</li> <li>将8压入执行栈底部</li> <li>输出10</li> <li>输出8，将9压入执行栈底部</li> <li>输出9</li> <li>输出5，将6压入回调队列，将7push进微任务</li> <li>输出7</li> <li>输出2，将3push进微任务队列，将4压入执行栈底部</li> <li>输出3</li> <li>输出4</li> <li>输出6</li></ol> <h3 id="闭包"><a href="#闭包" aria-hidden="true" class="header-anchor">#</a> 闭包</h3> <h4 id="变量的作用域"><a href="#变量的作用域" aria-hidden="true" class="header-anchor">#</a> 变量的作用域</h4> <p>要理解闭包，首先必须理解 JavaScript 特殊的变量作用域。</p> <p>变量的作用域无非就是两种：全局变量和局部变量。</p> <p>JavaScript 语言的特殊之处，就在于函数内部可以直接读取全局变量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 999</span>
</code></pre></div><p>另一方面，在函数外部无法读取函数内的局部变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">888</span><span class="token punctuation">;</span>  <span class="token comment">// 这里要注意，函数内部声明变量的时候，一定要用 var 命令。如果不用的话，你实际上声明了一个全局变量。</span>
<span class="token punctuation">}</span>
<span class="token function">alert</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
</code></pre></div><h4 id="如何从外部读取局部变量"><a href="#如何从外部读取局部变量" aria-hidden="true" class="header-anchor">#</a> 如何从外部读取局部变量</h4> <p>出于种种原因，我们有时候需要得到函数内的局部变量。但是，前面已经说过了，正常情况下，这是办不到的，只有通过变通方法才能实现。</p> <p>那就是在函数的内部，再定义一个函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在上面的代码中，函数f2就被包括在函数f1内部，这时f1内部的所有局部变量，对f2都是可见的。但是反过来就不行，f2内部的局部变量，对f1就是不可见的。这就是 JavaScript 语言特有的“链式作用域”结构（chain scope），子对象会一级一级地向上寻找所有父对象的变量。所以，父对象的所有变量，对子对象都是可见的，反之则不成立。</p> <p>既然f2可以读取f1中的局部变量，那么只要把f2作为返回值，我们不就可以在f1外部读取它的内部变量了吗！</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span>
  <span class="token comment">// 函数f2就被包括在函数f1内部，这时f1内部的所有局部变量，对f2都是可见的。</span>
  <span class="token comment">// 但是反过来就不行，f2内部的局部变量，对f1就是不可见的</span>
  <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 既然f2可以读取f1中的局部变量，那么只要把f2作为返回值，我们不就可以在f1外部读取它的内部变量了吗！</span>
  <span class="token keyword">return</span> f2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 999</span>

</code></pre></div><h4 id="闭包的概念"><a href="#闭包的概念" aria-hidden="true" class="header-anchor">#</a> 闭包的概念</h4> <p>上一节代码中的 f2 函数，就是闭包。<u>闭包就是能够读取其他函数内部变量的函数。</u>由于在 JavaScript 语言中，只有函数内部的子函数才能读取局部变量，因此可以把闭包简单理解成“定义在一个函数内部的函数”。所以，在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。</p> <h4 id="闭包的用途"><a href="#闭包的用途" aria-hidden="true" class="header-anchor">#</a> 闭包的用途</h4> <p>闭包可以用在许多地方。它的最大用处有两个，一个是前面提到的可以读取函数内部的变量，另一个就是让这些变量的值始终保持在内存中。（高阶函数）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span>
    <span class="token function-variable function">nAdd</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 999</span>
  <span class="token function">nAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1000</span>
</code></pre></div><p>在这段代码中，result 实际上就是闭包 f2 函数，它一共运行了两次，第一次的值是999，第二次的值是1000。这证明了，函数 f1 中的局部变量一直保存在内存中，并没有在 f1 调用后被自动清除。</p> <p>为什么回这样呢？<u>原因就在于f1是f2的父函数，而f2被赋给了一个全局变量，这导致 f2 始终在内存中，而 f2 的存在依赖于f1，因此f2也始终内存中，不会在调用结束后，被垃圾回收机制（garbage collection）回收。</u></p> <p>这段呢代码中另一个值得注意的地方，就是<code>nAdd=function() { n + 1}</code> 这一行，首先在 nAdd 前面没有使用 var 关键字，因此 nAdd 是一个全局变量，而不是局部变量。其次，nAdd 的值是一个匿名函数（anonymous function），而这个匿名函数本身也是一个闭包，所以 nAdd 相当于是一个 setter，可以在函数外部对函数内部的局部变量进行操作。</p> <h4 id="使用闭包的注意点"><a href="#使用闭包的注意点" aria-hidden="true" class="header-anchor">#</a> 使用闭包的注意点</h4> <ol><li>由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题。解决方法是，在退出函数之前，将不使用的局部变量全部删除。</li> <li>闭包回在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。</li></ol> <p>如立即执行函数 + 闭包，实现模块的基本方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> privateName <span class="token operator">=</span> <span class="token string">&quot;inner&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 私有变量</span>
  <span class="token keyword">const</span> <span class="token function-variable function">privateFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;私有函数&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 私有函数</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 公有属性</span>
    <span class="token function-variable function">sayName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 公有函数</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="闭包引起内存泄漏"><a href="#闭包引起内存泄漏" aria-hidden="true" class="header-anchor">#</a> 闭包引起内存泄漏</h4> <h3 id="js-前端模块化"><a href="#js-前端模块化" aria-hidden="true" class="header-anchor">#</a> JS 前端模块化</h3> <h4 id="抛出问题"><a href="#抛出问题" aria-hidden="true" class="header-anchor">#</a> 抛出问题</h4> <ul><li>在开发中在导入模块时经常使用 <code>require</code> 和 <code>import</code>；</li> <li>导出模块时使用 <code>module.exports/exports</code> 或者 <code>export/export default</code>;</li> <li>有时候为了引用一个模块会使用 <code>require</code> 奇怪的是也可以使用<code>import</code>？它们之间有何区别？</li></ul> <h4 id="追溯根源，来到js模块化规范"><a href="#追溯根源，来到js模块化规范" aria-hidden="true" class="header-anchor">#</a> 追溯根源，来到Js模块化规范</h4> <p>随着网站逐渐互联网应用程序，嵌入网页的 JavaScript 代码越来越判断
网页越来越像桌面程序，需要一个团队分工协作、进度管理、单元测试等等......开发者不得不使用软件工程的方法，管理网页的业务逻辑。</p> <p>JavaScript 模块化编程，已经成为一个迫切的需求。理想情况下，<u>开发者只需要实现核心的业务逻辑，其他都可以加载别人已经写好的业务逻辑。</u></p> <p>前端模块化，主要解决两个问题——“命名空间冲突”，“文件依赖管理”。</p> <ol><li><p><strong>坑——命名空间冲突</strong></p> <ul><li>我自己测试好的代码和大家合并后怎么起冲突了？</li> <li>页面脚本的变量或函数覆盖了公有脚本的。</li></ul></li> <li><p><strong>坑——文件依赖管理</strong></p> <ul><li>明明项目需要引入的包都引进来了怎么还报缺少包？</li> <li>手动管理依赖，有天要更换某个插件，要深入代码内部进行修改。</li> <li>如下，在 F.js 中，分不清某个变量是来自 C.js，还是 E.js 。<div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>A.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>B.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>C.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>D.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>E.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>F.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li>两次加载同一个模块。比如引入了两遍 JQ。</li></ul></li> <li><p><strong>其他的坑</strong></p> <ul><li>为了实现脚本复用，将一个很大的公用 <code>public</code> 文件引入各个页面中，其中的某些函数，只有个别页面用到。（资源浪费）</li> <li>某个功能的函数群函数，与另一个功能的函数群摆在一起，使用注释来分隔。</li></ul></li> <li><p><strong>目前解决的方法是：模块化</strong></p> <ul><li>命名空间：各个模块的命名空间独立。A 模块的变量x不会覆盖B模块的变量x。</li> <li>模块的依赖关系：通过模块管理工具如 webpack/require/browserify 等管理。</li></ul></li></ol> <h4 id="原始写法"><a href="#原始写法" aria-hidden="true" class="header-anchor">#</a> 原始写法</h4> <p>模块就是实现特定功能的一组方法。
只要把不同的函数（以及记录状态的变量）简单放在一起，就算是一个模块。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的函数 m1() 和 m2()，组成一个模块。使用的时候，直接调用就好了。
这种做法的缺点很明显：“污染”了全局变量，无法保证不与其他模块发生变量名冲突，而且模块成员之间看不出直接关系，这样子使得每想命名一个变量的时候都要三思。</p> <h4 id="使用命名空间——对象写法"><a href="#使用命名空间——对象写法" aria-hidden="true" class="header-anchor">#</a> 使用命名空间——对象写法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> module1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  _count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function-variable function">m1</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">m2</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的函数 m1() 和 m2()，都封装在 module1 对象里。使用的时候，就是调用这个对象的属性。</p> <div class="language-js extra-class"><pre class="language-js"><code>module1<span class="token punctuation">.</span><span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>但是，这样的写法会暴露所有模块成员，内部状态可以被外部改写。比如，外部代码可以直接改变内部计数器的值。</p> <div class="language-js extra-class"><pre class="language-js"><code>module1<span class="token punctuation">.</span>_count <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="立即执行函数-闭包（实现模块的基本方法）"><a href="#立即执行函数-闭包（实现模块的基本方法）" aria-hidden="true" class="header-anchor">#</a> 立即执行函数 + 闭包（实现模块的基本方法）</h4> <p>立即函数可以创建作用域，闭包则可以形成私有变量和函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建</span>
<span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> privateName <span class="token operator">=</span> <span class="token string">&quot;inner&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 私有变量</span>
  <span class="token keyword">const</span> <span class="token function-variable function">privateFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;私有函数&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 私有函数</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 公有属性</span>
    <span class="token function-variable function">sayName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 公有函数</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 使用</span>
module<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Jecyu</span>
</code></pre></div><p>总结：这是目前比较常用的模块定义方式，可以区分私有成员和公有成员。公有变量和方法，和之前一样可以直接通过 <code>module.name</code> 的方式修改。私有变量和方法，是无法访问的，除非给你个修改私有成员的公有方法。</p> <h4 id="放大模式"><a href="#放大模式" aria-hidden="true" class="header-anchor">#</a> 放大模式</h4> <p>如果一个模块很大，必须分成几个部分，或者一个模块需要继承另一个模块，这时就有必要采用“放大模式”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> module1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> privateName <span class="token operator">=</span> <span class="token string">&quot;inner1&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 私有变量</span>
  <span class="token keyword">const</span> <span class="token function-variable function">privateFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;私有函数1&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 私有函数</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;Jecyu1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 公有属性</span>
    <span class="token function-variable function">sayName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 公有函数</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    anotherName<span class="token punctuation">:</span> mod<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token comment">// 另一个模块上的公用参数</span>
    sayAnotherName<span class="token punctuation">:</span> mod<span class="token punctuation">.</span>sayname <span class="token comment">// 另一个模块上的公有方法</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>anotherModule<span class="token punctuation">)</span> <span class="token comment">// 引入了另一个模块</span>
<span class="token comment">// 使用</span>
module1<span class="token punctuation">.</span>sayOtherName
</code></pre></div><p>除了上面这种外，在浏览器环境中，模块的各个部分通常都是从网上获取的，有时无法知道哪个部分会先加载。一次，避免第一个执行的部分有可能加载一个不存在空对象，这时就采用“宽放大模式”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> module1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>anotherModule <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>可以看 Vue.js 的文件即是一个立即执行函数 + 闭包的模式，<a href="https://cdn.jsdelivr.net/npm/vue/dist/vue.js" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/npm/vue/dist/vue.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="告别刀耕火种的时代——模块化构建工具（解决依赖管理）"><a href="#告别刀耕火种的时代——模块化构建工具（解决依赖管理）" aria-hidden="true" class="header-anchor">#</a> 告别刀耕火种的时代——模块化构建工具（解决依赖管理）</h4> <p>js 模块是从立即执行函数开始的，但是等到真正使用构建工具的时候，业界采用的模块化方案，却并非是一个一个由立即函数+闭包形成的集群。而是采用了诸如 AMD/CMD/CommonJS/ES6等模块化实现。</p> <p>这里面的原因可能有这几个：</p> <ul><li>闭包的性能问题。（使用闭包十分容易导致浏览器的内存泄漏，严重情况下会是浏览器挂死。）</li> <li>当模块增多的时候，需要解决模块间依赖管理问题。关于依赖管理，如下：<div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>A.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>B.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>C.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>D.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>E.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>F.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div>HTML 中引入了两遍的 JQ，导致脚本报错。有个公用脚本，包含了 N 多的公用模块。有些页面明明只用到了一个模块，也必须全部加载一遍。
综上，必须使用模块化管理工具。</li></ul> <p><strong>几个概念：</strong></p> <p>ES6规范/webpack/rollup 模块化处理</p> <table><thead><tr><th>包管理工具</th> <th>模块化构建工具</th> <th>模块化规范</th></tr></thead> <tbody><tr><td>npm</td> <td>webpack</td> <td>es6模块</td></tr> <tr><td>bower（被干掉了）</td> <td>requireJS/seaJS/browserify（正在衰落）</td> <td>AMD/CMD/CommonJS</td></tr></tbody></table> <ul><li><strong>包管理工具</strong>：安装、卸载、更新、查看、搜索、发布包。比如你需要按照个 jq 等，通过 npm 来安装。npm 里有依赖管理，假如 jq 或者说 express 升级了，原来代码不能用了，帮助你解决这个问题的就是 npm。</li> <li><strong>模块化构建工具</strong>：webpack/requireJS/seaJS，等是用来组织前端模块的构建工具（加载器）。通过使用模块化规范（AMD/CMD/CommonJS/es6）的语法来实现<u>按需加载</u>。举个例子，如果有有一天你不用维护一个很长很长的公用脚本文件，这得感谢它。</li> <li><strong>模块化规范</strong>：AMD/CMD/CommomJS/es6模块等规范，规范了如何来组织你的代码。一般这种方式写的代码浏览器不认，需要用模块化构建工具来打包编译成浏览器可以识别的文件。</li></ul> <p><strong>npm与bower比较</strong></p> <ul><li>原来 bower 的使用优势就是适合前端模块管理，而 npm 被视为只适合后端的管理。但是随着 webpack的流行，这个已经 npm 胜出了。npm + webpack，可以实现良好的前端模块管理。</li></ul> <p><strong>webpack 与 requireJS 比较</strong>：</p> <table><thead><tr><th>构建工具</th> <th>支持的规范</th> <th>特点</th></tr></thead> <tbody><tr><td>webpack</td> <td>AMD/CMD/CommonJS/es6模块</td> <td>功能强大，一统江湖</td></tr> <tr><td>requireJS</td> <td>AMD</td> <td>每个页面必须引入 require.js，移动端不友好</td></tr> <tr><td>seaJS</td> <td>CMD</td> <td>与 requireJS 类似，推崇依赖后置。社区衰微，不建议入</td></tr> <tr><td>browserify</td> <td>CommonJS</td> <td>仅适合后端</td></tr></tbody></table> <p><strong>几种模块化规范比较：</strong></p> <table><thead><tr><th>模块化规范</th> <th>怎样加载模块</th> <th>缺点</th> <th>场景</th></tr></thead> <tbody><tr><td>es6 模块</td> <td>依赖在编译时完成的（最佳）</td> <td>目前对 es6 支持还不够，使用时需要用 babel 等转义</td> <td>未来前端模块管理的规范</td></tr> <tr><td>AMD</td> <td>异步加载模块，依赖前置（依赖必须一开始写好）</td> <td>写法冗余，依赖多的时候，很痛苦。</td> <td>前端残留势力</td></tr> <tr><td>CMD</td> <td>异步假装模块，依赖后置（依赖可以就近书写）</td> <td>与 AMD 类似</td> <td>被创始人说已死的规范</td></tr> <tr><td>CommonJS</td> <td>同步加载</td> <td>仅适合后端，浏览器端同步假装页面会阻塞的</td> <td>Node.js 默认支持，而且不完全按 CommonJS 的标准来实现</td></tr></tbody></table> <p><strong>CommonJS 规范（同步加载模块）</strong></p> <ul><li>允许模块通过 require 方法来同步加载所要依赖的其他模块，然后通过 exports 或 module.exports 来导出需要暴露的接口。</li> <li>使用方式<div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 导入</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../app.j&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 导出</span>
  <span class="token keyword">export</span><span class="token punctuation">.</span><span class="token function-variable function">getStoreInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> someValue<span class="token punctuation">;</span>
</code></pre></div></li> <li>优点：
<ul><li>简单容易使用</li> <li>服务端模块便于复用</li></ul></li></ul> <p><strong>AMD（异步加载模块）</strong></p> <ul><li>采用异步方式加载模块，模块的加载不影响后面语句的运行。所有依赖模块的语句，都定义在一个回调函数中，等到加载完成之后，回调函数才执行。<div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 定义</span>
  <span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;dep1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dep2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d1<span class="token punctuation">,</span> d2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 加载模块</span>
  require<span class="token punctuation">[</span><span class="token string">&quot;moduel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.../app]&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>加载模块 <code>require([module], callback)</code>；第一个参数[module]，是一个数组，里面的成员就是要加载的模块；第二个参数 callback 是加载成功之后的回调函数。</li> <li>Require.js 执行过程：
<ol><li>require 函数检查依赖的模块，根据配置文件，获取 js 问及爱你的实际路径。</li> <li>根据 js 文件实际路径，在 dom 中插入 script 节点，并绑定呢 onload 事件来获取该模块加载完成的通知。</li> <li>依赖 script 全部加载完成后，调用回调函数。
通过上面的步骤后，就真正解决的之前的文件依赖管理问题。</li></ol></li></ul> <p><strong>UMD</strong></p> <ul><li>UMD 是 AMD 和 CommonJS 的糅合。</li> <li>AMD 以浏览器第一原则发展异步加载模块。</li> <li>CommonJS 模块以服务器第一原则发展，选择同步假装，它的模块无需包装。</li> <li>UMD 先判断是否支持 Node.js 的模块（exports）是否存在，存在则使用 Node.js 模块模式；在判断是否支持 AMD（define是否存在），存在则使用 AMD 方式加载模块。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> defiine <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">define</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>eventUtil <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// module...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>像 vue.js 文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> module <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
  <span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd <span class="token operator">?</span> <span class="token function">define</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span> <span class="token punctuation">:</span>
  <span class="token punctuation">(</span>global <span class="token operator">=</span> global <span class="token operator">||</span> self<span class="token punctuation">,</span> global<span class="token punctuation">.</span>Vue <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>ES6模块化</strong></p> <ul><li>ES6 在语言标准的层面上，实现了模块功能，而且实现得相当简单，完全可以取代 CommonJS 和 AMD 规范，成为浏览器和服务器通用的模块解决方案。</li> <li>ES6 模块设计思想：尽量的静态化、使得编译时就能确定模块的依赖关系，以及输入和输出的变量。？（CommonJS 和 AMD 模块，都只能在运行时确定这些东西。）</li> <li>使用方式<div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 导入</span>
  <span class="token keyword">import</span> <span class="token string">&quot;/app&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 导出</span>
  <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> year <span class="token operator">=</span> <span class="token string">&quot;2018&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>优点：
<ul><li>容易进行静态分析。</li> <li>面向未来的 ECMAScript 标准</li></ul></li> <li>缺点：
<ul><li>原生浏览器端还没有实现该标准。</li> <li>全新的命令字，新版的 Node.js 才支持。</li></ul></li></ul> <p>综上结论，就是使用搭配：<strong>npm + webpack + es6 模块。</strong></p> <h4 id="回到问题“require-与-import-的区别“"><a href="#回到问题“require-与-import-的区别“" aria-hidden="true" class="header-anchor">#</a> 回到问题“require 与 import 的区别“</h4> <ul><li>require 使用于 CommonJS 规范，import 使用于 ES6 模块规范，两种的区别实质是两种规范的区别。</li> <li>CommonJS
<ul><li>对于基本数据类型，属于复制。即会被模块缓存；同时，在另一个模块可以对该模块输出的变量重新赋值。</li> <li>对于复杂数据类型，属于浅拷贝。由于两个模块引用的对象指向同一个内存空难功能键你，因此对该模块的值做修改时会影响另一个模块。</li> <li>当使用 require 命令加载某个模块时，就会运行整个模块的代码。</li> <li>当使用 require 命令加载同一个模块时，不会再执行该模块，而是取到缓存之中的值。也就是说，CommonJS 模块无论加载多少次，都只会再第一次加载时运行一次，以后再加载，就会烦第一次运行的结果，除非手动清除系统缓存。</li> <li>循环加载时，属于加载时执行。即脚本代码在 require 的时候，就会全部执行。一旦出现某个模块被“循环加载”，就只输出已经执行的部分，还未执行的部分不会输出。</li></ul></li> <li>ES6 模块
<ul><li>ES6 模块中的值属于【动态只读引用】。</li> <li>对于只读来说，即不允许修改引入变量的值，import 的变量是只读的，无论是基本数据类型还是复杂数据类型。当模块遇到 import 命令时，就会生成一个只读引用。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里去取值。</li> <li>循环加载时，ES6模块是动态引用。只要两个模块之间存在某个引用，代码就能够执行。</li> <li>最后：require/exports 是必要通用且必须的；因为事实上，目前你编写的 <code>import/export</code> 最终都是编译为 <code>require/exports</code> 来执行的。</li></ul></li></ul> <p><strong>webpack/rollup 最终打包后的文件里，是如何解决依赖关系的，还会使用到闭包么？</strong></p> <p>webpack 的打包成一个文件，也可以打包为多个文件，它跟 require.js 的实现有什么不同的？</p> <h4 id="npm-webpack-es6"><a href="#npm-webpack-es6" aria-hidden="true" class="header-anchor">#</a> npm + webpack + es6</h4> <p><strong>使用 es6 模块语法</strong></p> <p>webpack 可以支持 es6 模块语法。我们需要先下载和配置 babel。
下载</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> babel-cli babel-core babel-eslin babel-loader babel-plugin-add-module-exports babel-plugin-transform-es2015-modules-umd babel-preset-env --dev
</code></pre></div><p>配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/src/js/index.js'</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/examples'</span><span class="token punctuation">,</span> <span class="token comment">// 打包文件的输出目录</span>
    filename<span class="token punctuation">:</span> outputFile<span class="token punctuation">,</span>
    library<span class="token punctuation">:</span> libraryName<span class="token punctuation">,</span>
    libraryTarget<span class="token punctuation">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span> <span class="token comment">// umd</span>
    umdNamedDefine<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/(\.jsx|\.js)$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        exclude<span class="token punctuation">:</span> <span class="token regex">/(node_modules)|bower_components/</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>之后就可以使用 <code>import/export</code> 语法了，最终使用 webpack 打包后的文件。
sum.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>app.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * webpack支持ES6、CommonJs和AMD规范
 */</span>

<span class="token comment">// ES6</span>
<span class="token keyword">import</span> sum <span class="token keyword">from</span> <span class="token string">&quot;./vendor/sum&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;sum(1, 2) = &quot;</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CommonJs</span>
<span class="token keyword">var</span> minus <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./vendor/minus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;minus(1, 2) = &quot;</span><span class="token punctuation">,</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// AMD</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;./vendor/multi&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">multi</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;multi(1, 2) = &quot;</span><span class="token punctuation">,</span> <span class="token function">multi</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="工具函数大全"><a href="#工具函数大全" aria-hidden="true" class="header-anchor">#</a> 工具函数大全</h2> <h3 id="类型判断"><a href="#类型判断" aria-hidden="true" class="header-anchor">#</a> 类型判断</h3> <h4 id="判断字符串类型是否为数字"><a href="#判断字符串类型是否为数字" aria-hidden="true" class="header-anchor">#</a> 判断字符串类型是否为数字</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">isNumberStr</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="数组"><a href="#数组" aria-hidden="true" class="header-anchor">#</a> 数组</h3> <blockquote><p>参考实现：lodash https://lodash.com/docs/4.17.15#intersection</p></blockquote> <h4 id="求交集和并集"><a href="#求交集和并集" aria-hidden="true" class="header-anchor">#</a> 求交集和并集</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> intersection <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> difference <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>a<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>b<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="用-apply-将数组添加到另一个数组"><a href="#用-apply-将数组添加到另一个数组" aria-hidden="true" class="header-anchor">#</a> 用 apply 将数组添加到另一个数组</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['a', 'b', 0, 1, 2]</span>
</code></pre></div><h3 id="浏览器操作及其它"><a href="#浏览器操作及其它" aria-hidden="true" class="header-anchor">#</a> 浏览器操作及其它</h3> <h4 id="检查是否位浏览器环境"><a href="#检查是否位浏览器环境" aria-hidden="true" class="header-anchor">#</a> 检查是否位浏览器环境</h4> <p>此代码段可用于确定当前运行环境是否为浏览器。这有助于避免在服务器（节点）上运行前端模块时出错。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">isBrowser</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token keyword">typeof</span> window<span class="token punctuation">,</span> <span class="token keyword">typeof</span> document<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">isBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true(browser)</span>
<span class="token function">isBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// fasle (Node)</span>
</code></pre></div><h4 id="返回指定函数的生效样式"><a href="#返回指定函数的生效样式" aria-hidden="true" class="header-anchor">#</a> 返回指定函数的生效样式</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getStyle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> ruleName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">[</span>ruleName<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">getStyle</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'font-size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="smoothscroll-滚动到指定元素区域"><a href="#smoothscroll-滚动到指定元素区域" aria-hidden="true" class="header-anchor">#</a> smoothScroll: 滚动到指定元素区域</h4> <p>该代码块可将指定元素滚动到浏览器窗口的可见区域。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">smoothScroll</span> <span class="token operator">=</span> <span class="token parameter">element</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">querySeletor</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    behavior<span class="token punctuation">:</span> <span class="token string">'smooth'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">smoothScroll</span><span class="token punctuation">(</span><span class="token string">'#fooBar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">smoothScroll</span><span class="token punctuation">(</span><span class="token string">'.fooBar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="深拷贝"><a href="#深拷贝" aria-hidden="true" class="header-anchor">#</a> 深拷贝</h3> <h3 id="字符串拼接"><a href="#字符串拼接" aria-hidden="true" class="header-anchor">#</a> 字符串拼接</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="js生成某个范围的随机整数"><a href="#js生成某个范围的随机整数" aria-hidden="true" class="header-anchor">#</a> JS生成某个范围的随机整数</h3> <blockquote><p>js没有提供一个现成的函数直接生成某个范围的随机数。
js只有一个Math.random() 函数返回一个浮点, 伪随机数在范围[0，1)。</p></blockquote> <p>我们只有利用Math.random() 函数，自己封装一些函数，实现生成某个范围的随机数。
实现生成某个范围色随机数也需要与一下函数配合使用：</p> <ul><li>Math.ceil() 向上取整</li> <li>Math.floor() 向下取整</li> <li>Math.round() 四舍五入</li></ul> <h4 id="以-0-～-10-为例理解生成某个范围的随机数"><a href="#以-0-～-10-为例理解生成某个范围的随机数" aria-hidden="true" class="header-anchor">#</a> 以 0 ～ 10 为例理解生成某个范围的随机数</h4> <p>首先我们以0～10为例，对生成某一个返回有一个简单的理解：
Math.random() * 10 会随机生成[0, 10]，但是是浮点数；</p> <p>生成[0,10]的随机整数，Math.round(Math.random()*10)，通过四舍五入可以将大于9.5的数值转换为10；
生成[0,10)的随机整数，Math.floor(Math.random() * 10); // 向下取整数
生成(0,10]的随机整数，Math.ceil(Math.random() * 10); // 向上取整数</p> <h4 id="生成随机整数的四种情况"><a href="#生成随机整数的四种情况" aria-hidden="true" class="header-anchor">#</a> 生成随机整数的四种情况</h4> <ol><li>min≤r≤max</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Random</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="内存管理"><a href="#内存管理" aria-hidden="true" class="header-anchor">#</a> 内存管理</h3> <h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://juejin.im/post/5d6aa4f96fb9a06b112ad5b1?utm_source=gold_browser_extension#heading-13" target="_blank" rel="noopener noreferrer">如何写出一个惊艳面试官的深拷贝?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5d5b4c2df265da03dd3d73e5#heading-15" target="_blank" rel="noopener noreferrer">从多线程到 Event Loop 全面梳理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> —— 少有的从计算机方面讲解逐步引申到浏览器的线程文章。</li> <li><a href="https://mp.weixin.qq.com/s/sVcGRUZqILCVgfhzRyODTg" target="_blank" rel="noopener noreferrer">内存管理速成教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> —— 漫画式讲解 JS 内存管理。</li> <li><a href="https://juejin.im/post/5da1a04ae51d45783d6122bf?utm_source=gold_browser_extension#heading-36" target="_blank" rel="noopener noreferrer">JavaScript 工具函数大全（新）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/59bfe84351882531b730bac2#comment" target="_blank" rel="noopener noreferrer">this, appy, call, bind<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> —— 作者一步步讲解，浅显易懂。</li> <li><a href="https://juejin.im/post/58c883ecb123db005311861a#heading-61" target="_blank" rel="noopener noreferrer">Ajax 知识体系大梳理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>—— 这是一篇万字长文, 系统梳理了ajax相关的知识体系, 几乎囊括了所有ajax的知识点.</li> <li><a href="https://blog.csdn.net/lianzhang861/article/details/79426385" target="_blank" rel="noopener noreferrer">Jquery ajax 同步阻塞引起的UI线程阻塞的坑（loading图片显示不出来，layer.load延迟）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- ajax 设置为同步请求时的分析。</li> <li><a href="https://segmentfault.com/a/1190000006966358#articleHeader2" target="_blank" rel="noopener noreferrer">前端模块化——技术选型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 说明模块化要解决的问题以及使用模块化构建工具解决依赖管理。</li> <li><a href="https://juejin.im/entry/57fee360a22b9d005b1d9ae3" target="_blank" rel="noopener noreferrer">Javascript 的匿名函数与自执行<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 匿名函数与闭包。</li> <li><a href="https://segmentfault.com/a/1190000006968235" target="_blank" rel="noopener noreferrer">npm + webpack + es6 初体验<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 前端工程化是大势所趋，我们将不再人工去实现 依赖管理，代码压缩混淆，测试，上线等开发流程，转而交由工具去完成</li> <li><a href="http://www.ruanyifeng.com/blog/2012/10/javascript_module.html" target="_blank" rel="noopener noreferrer">Javascript模块化编程（一）：模块的写法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 简洁、清晰、透彻</li> <li><a href="https://segmentfault.com/a/1190000015991869#articleHeader0" target="_blank" rel="noopener noreferrer">谈谈Js前端模块化规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 详细的 JS 模块化规范对比。</li> <li>[npm + webpack + es6 初体验](npm + webpack + es6 初体验)</li> <li><a href="https://www.cnblogs.com/rubylouvre/p/3495286.html" target="_blank" rel="noopener noreferrer">JavaScript Promise：去而复返<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> -- 目前看过最好的 Promise 文章，讲解从为什么到怎么做。s</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/2/2021, 1:24:26 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Notebook/assets/js/app.fae3116e.js" defer></script><script src="/Notebook/assets/js/3.8a90166b.js" defer></script><script src="/Notebook/assets/js/7.a97cfeeb.js" defer></script>
  </body>
</html>
